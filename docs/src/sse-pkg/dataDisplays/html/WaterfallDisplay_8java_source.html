<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>OpenSonATA Source Code Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<a href="../../index.html">Back to setiCode Home</a><BR>

<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>WaterfallDisplay.java</h1><a href="WaterfallDisplay_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Class that displays the WaterFall.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Project: OpenSonATA</span>
<a name="l00005"></a>00005 <span class="comment"> * Version: 1.0</span>
<a name="l00006"></a>00006 <span class="comment"> * Author:  Jon Richards (current maintainer)</span>
<a name="l00007"></a>00007 <span class="comment"> *          The OpenSonATA code is the result of many programmers over many </span>
<a name="l00008"></a>00008 <span class="comment"> *          years.</span>
<a name="l00009"></a>00009 <span class="comment"> *  </span>
<a name="l00010"></a>00010 <span class="comment"> * This class displays an FFT waterfall plot of SonATA data.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * Copyright 2010 The SETI Institute</span>
<a name="l00013"></a>00013 <span class="comment"> * </span>
<a name="l00014"></a>00014 <span class="comment"> * Licensed under the Apache License, Version 2.0 (the "License"); </span>
<a name="l00015"></a>00015 <span class="comment"> * you may not use this file except in compliance with the License. </span>
<a name="l00016"></a>00016 <span class="comment"> * You may obtain a copy of the License at </span>
<a name="l00017"></a>00017 <span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0 Unless required by </span>
<a name="l00018"></a>00018 <span class="comment"> * applicable law or agreed to in writing, software distributed </span>
<a name="l00019"></a>00019 <span class="comment"> * under the License is distributed on an "AS IS" BASIS, WITHOUT </span>
<a name="l00020"></a>00020 <span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. </span>
<a name="l00021"></a>00021 <span class="comment"> * See the License for the specific language governing permissions </span>
<a name="l00022"></a>00022 <span class="comment"> * and limitations under the License. </span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * Attribution must be: “Licensed through SETI” in all published</span>
<a name="l00025"></a>00025 <span class="comment"> * uses of the software including analytics based on the software,</span>
<a name="l00026"></a>00026 <span class="comment"> * combined and merged software, papers, articles, books, reports,</span>
<a name="l00027"></a>00027 <span class="comment"> * web pages, etc.</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00045"></a>00045 <span class="keyword">package </span>opensonata.dataDisplays;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">import</span> javax.swing.*;
<a name="l00048"></a>00048 <span class="keyword">import</span> javax.swing.border.*;
<a name="l00049"></a>00049 <span class="keyword">import</span> javax.swing.event.*;
<a name="l00050"></a>00050 <span class="keyword">import</span> java.awt.*;
<a name="l00051"></a>00051 <span class="keyword">import</span> java.awt.event.*;
<a name="l00052"></a>00052 <span class="keyword">import</span> java.awt.image.*;
<a name="l00053"></a>00053 <span class="keyword">import</span> java.awt.geom.*;
<a name="l00054"></a>00054 <span class="keyword">import</span> java.text.*;
<a name="l00055"></a>00055 <span class="keyword">import</span> java.io.*;
<a name="l00056"></a>00056 <span class="keyword">import</span> javax.swing.filechooser.*;
<a name="l00057"></a>00057 <span class="keyword">import</span> javax.imageio.*;
<a name="l00058"></a>00058 <span class="keyword">import</span> java.awt.print.PrinterJob;
<a name="l00059"></a>00059 <span class="keyword">import</span> java.awt.print.*;
<a name="l00060"></a>00060 <span class="keyword">import</span> edu.emory.mathcs.jtransforms.fft.DoubleFFT_1D;
<a name="l00061"></a>00061 <span class="keyword">import</span> ptolemy.plot.*;
<a name="l00062"></a>00062 
<a name="l00067"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html">00067</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html">WaterfallDisplay</a> <span class="keyword">extends</span> JPanel implements <a class="code" href="interfaceopensonata_1_1dataDisplays_1_1ReadoutListener.html">ReadoutListener</a> 
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="comment">//The input filename specified on the command line or selected by the user.</span>
<a name="l00071"></a>00071     String inFilename;
<a name="l00072"></a>00072     <span class="comment">//The output filename specified on the command line or selected by the user.</span>
<a name="l00073"></a>00073     String outFilename;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     <span class="comment">//the width and height of the waterfall image</span>
<a name="l00076"></a>00076     <span class="keywordtype">int</span> width;
<a name="l00077"></a>00077     <span class="keywordtype">int</span> height;
<a name="l00078"></a>00078     <span class="keywordtype">float</span> pixelScaleFactor;
<a name="l00079"></a>00079     <span class="keywordtype">float</span> pixelOffsetFactor;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">// FFT waterfall image buffers</span>
<a name="l00082"></a>00082     BufferedImage origBuffImage;
<a name="l00083"></a>00083     BufferedImage scaledBuffImage;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html">FileScanner</a> fileScanner;
<a name="l00086"></a>00086     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html">CoefConversion</a> coefConversion;
<a name="l00087"></a>00087     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html">AverageComplexAmplitudes</a> averageComplexAmplitudes;
<a name="l00088"></a>00088     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html">ComplexAmplitudes</a> compAmps;
<a name="l00089"></a>00089     <a class="code" href="classopensonata_1_1dataDisplays_1_1ReadoutPlot.html">ReadoutPlot</a> readoutPlot;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     PrinterJob printJob;
<a name="l00092"></a>00092     <span class="keyword">final</span> <span class="keywordtype">int</span> imageType = BufferedImage.TYPE_BYTE_GRAY;
<a name="l00093"></a>00093     <span class="keywordtype">int</span> MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME = 512;
<a name="l00094"></a>00094     <span class="keywordtype">int</span> MAX_SUBBAND_BINS_PER_1HZ_HALF_FRAME = 1024;
<a name="l00095"></a>00095     <span class="keywordtype">boolean</span> readGrayscalePixels = <span class="keyword">false</span>;
<a name="l00096"></a>00096     <span class="keywordtype">int</span> displayResolution = 1;
<a name="l00097"></a>00097     <span class="keywordtype">boolean</span> slowPlay = <span class="keyword">false</span>;
<a name="l00098"></a>00098     <span class="keywordtype">boolean</span> repeatPlay = <span class="keyword">false</span>;
<a name="l00099"></a>00099     <span class="keywordtype">boolean</span> usingGui = <span class="keyword">true</span>;
<a name="l00100"></a>00100     String title = <span class="stringliteral">""</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="comment">// for selecting the particular subband to display among those in the file</span>
<a name="l00103"></a>00103     <span class="keywordtype">int</span> subbandOffset;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="comment">// GUI components</span>
<a name="l00106"></a>00106     JFrame mainGuiFrame;
<a name="l00107"></a>00107     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html">ImagePanel</a> imagePanel;
<a name="l00108"></a>00108     JFrame plotFrame;
<a name="l00109"></a>00109     JFrame imageAdjustmentFrame;
<a name="l00110"></a>00110     JLabel polValueLabel;
<a name="l00111"></a>00111     JLabel currentFileText;
<a name="l00112"></a>00112     JLabel subbandNumberValueLabel;
<a name="l00113"></a>00113     JLabel rfCenterFreqValueLabel;
<a name="l00114"></a>00114     JLabel halfFrameNumberValueLabel;
<a name="l00115"></a>00115     JLabel binFreqReadoutValueLabel;
<a name="l00116"></a>00116     JLabel binNumberReadoutValueLabel;
<a name="l00117"></a>00117     JLabel bandwidthValueLabel;
<a name="l00118"></a>00118     JLabel activityIdValueLabel;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     JLabel aveCompAmpsSubbandNumberValueLabel;
<a name="l00121"></a>00121     JLabel aveCompAmpsBinFreqReadoutValueLabel;
<a name="l00122"></a>00122     JLabel aveCompAmpsBinNumberReadoutValueLabel;
<a name="l00123"></a>00123     JLabel aveCompAmpsPowerReadoutValueLabel;
<a name="l00124"></a>00124     JLabel aveCompAmpsBandwidthValueLabel;
<a name="l00125"></a>00125     JLabel aveCompAmpsCurrentFileText;
<a name="l00126"></a>00126 
<a name="l00131"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html">00131</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html">ImagePanel</a> <span class="keyword">extends</span> JPanel implements Printable 
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133         BufferedImage image;
<a name="l00134"></a>00134 
<a name="l00138"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#f0df981ee4aee772214e829e94221b6f">00138</a>         <span class="keyword">public</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#f0df981ee4aee772214e829e94221b6f">ImagePanel</a>() 
<a name="l00139"></a>00139         {
<a name="l00140"></a>00140             setCursor(<span class="keyword">new</span> Cursor(Cursor.CROSSHAIR_CURSOR));
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142 
<a name="l00148"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#f9a75cb170deea51704826b00bc8540e">00148</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#f9a75cb170deea51704826b00bc8540e">setImage</a>(BufferedImage image)
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150             this.image = image;
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00158"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#47d14f13590dd00ff2fae0a8fe635a70">00158</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#47d14f13590dd00ff2fae0a8fe635a70">paintComponent</a>(Graphics g)
<a name="l00159"></a>00159         {
<a name="l00160"></a>00160             super.paintComponent(g); <span class="comment">// paint background</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             <span class="comment">// Draw image at its natural size.</span>
<a name="l00163"></a>00163             g.drawImage(image, 0, 0, <span class="keyword">this</span>); 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166 
<a name="l00178"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#e82c53bd83f6dc3fd5bfdde6a494e861">00178</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#e82c53bd83f6dc3fd5bfdde6a494e861">print</a>(Graphics g, PageFormat pageFormat, <span class="keywordtype">int</span> pageIndex)
<a name="l00179"></a>00179             <span class="keywordflow">throws</span> PrinterException
<a name="l00180"></a>00180             {
<a name="l00181"></a>00181                 <span class="keywordflow">if</span> (pageIndex &gt;= 1)
<a name="l00182"></a>00182                 {
<a name="l00183"></a>00183                     <span class="keywordflow">return</span> Printable.NO_SUCH_PAGE;
<a name="l00184"></a>00184                 }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186                 <span class="comment">// create a copy of the image that has the grayscale inverted </span>
<a name="l00187"></a>00187                 <span class="comment">// (black for white)</span>
<a name="l00188"></a>00188                 <span class="comment">// to save toner on printouts</span>
<a name="l00189"></a>00189                 <span class="keywordtype">int</span> tableLen = 256;
<a name="l00190"></a>00190                 <span class="keywordtype">short</span>[] grayscaleInvertTable = <span class="keyword">new</span> <span class="keywordtype">short</span>[tableLen];
<a name="l00191"></a>00191                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tableLen; i++)
<a name="l00192"></a>00192                 {
<a name="l00193"></a>00193                     grayscaleInvertTable[i] = (short) ((tableLen-1) - i);
<a name="l00194"></a>00194                 }
<a name="l00195"></a>00195                 BufferedImageOp grayInvertOp =
<a name="l00196"></a>00196                     <span class="keyword">new</span> LookupOp(<span class="keyword">new</span> ShortLookupTable(0, grayscaleInvertTable),
<a name="l00197"></a>00197                             null);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199                 BufferedImage grayInvertedImage = 
<a name="l00200"></a>00200                     <span class="keyword">new</span> BufferedImage(width, height, imageType);
<a name="l00201"></a>00201                 grayInvertOp.filter(image, grayInvertedImage);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 Graphics2D g2 = (Graphics2D) g;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205                 <span class="comment">//--- Translate the origin to 0,0 for the top left corner</span>
<a name="l00206"></a>00206                 g2.translate (pageFormat.getImageableX (),
<a name="l00207"></a>00207                         pageFormat.getImageableY ());
<a name="l00208"></a>00208 
<a name="l00209"></a>00209                 <span class="comment">// Scale the image to fit properly on the output printed page.</span>
<a name="l00210"></a>00210                 <span class="keywordtype">double</span> POINTS_PER_INCH = 72;
<a name="l00211"></a>00211                 <span class="keywordtype">double</span> widthScaleFactor = 
<a name="l00212"></a>00212                     pageFormat.getImageableWidth()  / POINTS_PER_INCH;
<a name="l00213"></a>00213                 <span class="keywordtype">double</span> heightScaleFactor = 
<a name="l00214"></a>00214                     pageFormat.getImageableHeight() / POINTS_PER_INCH; 
<a name="l00215"></a>00215 
<a name="l00216"></a>00216                 <span class="comment">// finally, draw the image.</span>
<a name="l00217"></a>00217                 g2.drawImage (grayInvertedImage,
<a name="l00218"></a>00218                         (<span class="keywordtype">int</span>) (0.25 * POINTS_PER_INCH),
<a name="l00219"></a>00219                         (<span class="keywordtype">int</span>) (0.25 * POINTS_PER_INCH),
<a name="l00220"></a>00220                         (<span class="keywordtype">int</span>) (widthScaleFactor * POINTS_PER_INCH),
<a name="l00221"></a>00221                         (<span class="keywordtype">int</span>) (heightScaleFactor * POINTS_PER_INCH),  
<a name="l00222"></a>00222                         <span class="keyword">this</span>);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224                 <span class="keywordflow">return</span> Printable.PAGE_EXISTS;
<a name="l00225"></a>00225             }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     } <span class="comment">//End of ImagePanel class.</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00238"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html">00238</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html">CoefConversion</a>
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240 
<a name="l00245"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">00245</a>         <span class="keyword">private</span> <span class="keywordtype">double</span>[] <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a> = null;  
<a name="l00246"></a>00246 
<a name="l00250"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#e3338d9910d585f327d07905b2b9310b">00250</a>         <span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#e3338d9910d585f327d07905b2b9310b">startNewDataStream</a>() 
<a name="l00251"></a>00251         {
<a name="l00252"></a>00252             <span class="comment">// need to flush out the pipelined data</span>
<a name="l00253"></a>00253             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a> = null;
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255 
<a name="l00262"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#9265b623997a5162960cb1eac9221575">00262</a>         <span class="keyword">public</span> <span class="keywordtype">double</span>[] <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#9265b623997a5162960cb1eac9221575">convertCoefsTo2HzFreqValues</a>(<span class="keywordtype">double</span> coef[]) 
<a name="l00263"></a>00263         {
<a name="l00264"></a>00264             <span class="comment">// Time sample order is real, imag in adjacent array elements.</span>
<a name="l00265"></a>00265             <span class="comment">// Note that transform occurs in-place, so a copy</span>
<a name="l00266"></a>00266             <span class="comment">// of the input array is used.</span>
<a name="l00267"></a>00267             <span class="keywordtype">double</span>[] results = <span class="keyword">new</span> <span class="keywordtype">double</span>[coef.length];
<a name="l00268"></a>00268             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;coef.length; i++)
<a name="l00269"></a>00269                 results[i] = coef[i];
<a name="l00270"></a>00270 
<a name="l00271"></a>00271             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#8fcae13612a83c7d26f6e5c19a8f67a2">convertCoefsToFreqValues</a>(results);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273             <span class="keywordflow">return</span> results;
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275 
<a name="l00284"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#786bd726dafbf3c1766ebe33bf931d05">00284</a>         <span class="keyword">public</span> <span class="keywordtype">double</span>[] <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#786bd726dafbf3c1766ebe33bf931d05">convertCoefsTo4HzFreqValues</a>(<span class="keywordtype">double</span> coef[]) 
<a name="l00285"></a>00285         {
<a name="l00286"></a>00286             <span class="comment">// Time sample order is real, imag in adjacent array elements.</span>
<a name="l00287"></a>00287             <span class="comment">// Note that transform occurs in-place, so a copy</span>
<a name="l00288"></a>00288             <span class="comment">// of the input array is used.</span>
<a name="l00289"></a>00289             <span class="keywordtype">double</span>[] results = <span class="keyword">new</span> <span class="keywordtype">double</span>[coef.length/2];
<a name="l00290"></a>00290             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;coef.length; i+=4)
<a name="l00291"></a>00291             {
<a name="l00292"></a>00292                 results[i/2]   = (coef[i] + coef[i+2])/2.0;
<a name="l00293"></a>00293                 results[i/2+1] = (coef[i+1] + coef[i+3])/2.0;;
<a name="l00294"></a>00294             }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#8fcae13612a83c7d26f6e5c19a8f67a2">convertCoefsToFreqValues</a>(results);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298             <span class="keywordflow">return</span> results;
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 
<a name="l00312"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#b212ea97821cf4afe6b396478bf9f305">00312</a>         <span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keywordtype">double</span>[] <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#b212ea97821cf4afe6b396478bf9f305">convertCoefsTo1HzFreqValues</a>(<span class="keywordtype">double</span> newCoef[]) 
<a name="l00313"></a>00313         {
<a name="l00314"></a>00314             <span class="comment">// arrays are twice as big as the MAX_SUBBAND_BINS consts</span>
<a name="l00315"></a>00315             <span class="comment">// because the real/imag values have been unpacked into</span>
<a name="l00316"></a>00316             <span class="comment">// adjacent array elements.</span>
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 
<a name="l00319"></a>00319             <span class="comment">// must be able to hold two 1KHz arrays</span>
<a name="l00320"></a>00320             <span class="keywordtype">double</span>[] combinedCoef = 
<a name="l00321"></a>00321                 <span class="keyword">new</span> <span class="keywordtype">double</span>[2 * 2 * MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME];
<a name="l00322"></a>00322 
<a name="l00323"></a>00323             <span class="comment">// If first time or a reset has occurred</span>
<a name="l00324"></a>00324             <span class="keywordflow">if</span> (<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a> == null) <span class="comment">// first time or reset</span>
<a name="l00325"></a>00325             {
<a name="l00326"></a>00326                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a> = <span class="keyword">new</span> <span class="keywordtype">double</span>[2 * MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME];
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                 <span class="comment">// Copy the new coefficients into the last half frame array</span>
<a name="l00329"></a>00329                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;newCoef.length; ++i)
<a name="l00330"></a>00330                 {
<a name="l00331"></a>00331                     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a>[i] = newCoef[i];
<a name="l00332"></a>00332                 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334                 <span class="comment">//Zero out the array to return.</span>
<a name="l00335"></a>00335                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;combinedCoef.length; ++i) 
<a name="l00336"></a>00336                 {
<a name="l00337"></a>00337                     combinedCoef[i] = 0;
<a name="l00338"></a>00338                 }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340                 <span class="keywordflow">return</span> combinedCoef;  <span class="comment">// return empty array the first time</span>
<a name="l00341"></a>00341             }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             <span class="comment">// copy the previous coefs</span>
<a name="l00344"></a>00344             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a>.length; ++i)
<a name="l00345"></a>00345             {
<a name="l00346"></a>00346                 combinedCoef[i] = <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a>[i];
<a name="l00347"></a>00347             }   
<a name="l00348"></a>00348 
<a name="l00349"></a>00349             <span class="comment">// add the new coefs on to the end of the last ones</span>
<a name="l00350"></a>00350             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;newCoef.length; ++i)
<a name="l00351"></a>00351             {
<a name="l00352"></a>00352                 combinedCoef[i+2*MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME] = newCoef[i];
<a name="l00353"></a>00353             }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355             <span class="comment">// convert them</span>
<a name="l00356"></a>00356             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#8fcae13612a83c7d26f6e5c19a8f67a2">convertCoefsToFreqValues</a>(combinedCoef);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358             <span class="comment">// save the most recent data for next time</span>
<a name="l00359"></a>00359             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;newCoef.length; ++i)
<a name="l00360"></a>00360             {
<a name="l00361"></a>00361                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#5b7f34e61bb413f2794df736073b9caa">prevCoef</a>[i] = newCoef[i];
<a name="l00362"></a>00362             }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364             <span class="keywordflow">return</span> combinedCoef;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367 
<a name="l00376"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#8fcae13612a83c7d26f6e5c19a8f67a2">00376</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#8fcae13612a83c7d26f6e5c19a8f67a2">convertCoefsToFreqValues</a>(<span class="keywordtype">double</span> coef[])
<a name="l00377"></a>00377         {
<a name="l00378"></a>00378 
<a name="l00379"></a>00379             <span class="comment">//The number of coefficients for the FFT </span>
<a name="l00380"></a>00380             <span class="keywordtype">int</span> transformLength = coef.length / 2;  <span class="comment">// N real, imag pairs</span>
<a name="l00381"></a>00381 
<a name="l00382"></a>00382             <span class="comment">// Perform the FFT. Values are placed back in coef[].</span>
<a name="l00383"></a>00383             DoubleFFT_1D fft = <span class="keyword">new</span> DoubleFFT_1D(transformLength);
<a name="l00384"></a>00384             fft.complexForward(coef);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386             <span class="comment">// Swap the left/right halves of the output array</span>
<a name="l00387"></a>00387             <span class="comment">// to get the negative freqs into the proper place.</span>
<a name="l00388"></a>00388             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; transformLength; ++i)
<a name="l00389"></a>00389             {
<a name="l00390"></a>00390                 <span class="keywordtype">double</span> temp = coef[i + transformLength];
<a name="l00391"></a>00391                 coef[i+transformLength] = coef[i];
<a name="l00392"></a>00392                 coef[i] = temp;
<a name="l00393"></a>00393             }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396             <span class="comment">// Normalize by the mean square value</span>
<a name="l00397"></a>00397             <span class="keywordtype">double</span> sumSquare = 0;
<a name="l00398"></a>00398             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;coef.length; i+=2)
<a name="l00399"></a>00399             {
<a name="l00400"></a>00400                 sumSquare += Math.abs(coef[i]) * Math.abs(coef[i]) +
<a name="l00401"></a>00401                     Math.abs(coef[i+1]) * Math.abs(coef[i+1]); 
<a name="l00402"></a>00402             }
<a name="l00403"></a>00403             <span class="keywordtype">double</span> meanSquare = sumSquare / transformLength;
<a name="l00404"></a>00404             <span class="keywordtype">double</span> norm = Math.sqrt(meanSquare);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;coef.length; ++i) 
<a name="l00407"></a>00407             {
<a name="l00408"></a>00408                 coef[i] /= norm;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410                 <span class="comment">// trim to min/max values</span>
<a name="l00411"></a>00411                 <span class="keywordtype">int</span> maxValue = 7;
<a name="l00412"></a>00412                 <span class="keywordtype">int</span> minValue = -maxValue;
<a name="l00413"></a>00413                 <span class="keywordflow">if</span> (coef[i] &gt; maxValue) coef[i] = maxValue;
<a name="l00414"></a>00414                 <span class="keywordflow">if</span> (coef[i] &lt; minValue) coef[i] = minValue;
<a name="l00415"></a>00415             }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 
<a name="l00430"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#6ccb5ea658261aba512ed0e8c9781c97">00430</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html#6ccb5ea658261aba512ed0e8c9781c97">convertFFTValuesToPixels</a>(<span class="keywordtype">double</span> coef[], <span class="keywordtype">int</span>[] pixbuff)
<a name="l00431"></a>00431         {
<a name="l00432"></a>00432 
<a name="l00433"></a>00433             <span class="keywordtype">int</span> maxPixelValue = 255;
<a name="l00434"></a>00434             <span class="keywordtype">double</span> maxPairValue = 7;
<a name="l00435"></a>00435             <span class="keywordtype">double</span> maxPowerValue =  maxPairValue * maxPairValue + 
<a name="l00436"></a>00436                 maxPairValue * maxPairValue;
<a name="l00437"></a>00437             <span class="keywordtype">double</span> scaleFactor = 4;  
<a name="l00438"></a>00438 
<a name="l00439"></a>00439             <span class="keywordtype">double</span> scale = (double) maxPixelValue / maxPowerValue * scaleFactor;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441             <span class="comment">// zero output buffer in case it's only partially filled</span>
<a name="l00442"></a>00442             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;pixbuff.length; ++i)
<a name="l00443"></a>00443             {
<a name="l00444"></a>00444                 pixbuff[i] = 0;
<a name="l00445"></a>00445             }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447             <span class="comment">// See the todo</span>
<a name="l00448"></a>00448             <span class="keywordtype">int</span> pixIndex = 0;
<a name="l00449"></a>00449             <span class="keywordtype">int</span> discard = (int) (coef.length * compAmps.overSampling);
<a name="l00450"></a>00450             <span class="keywordtype">int</span> ofs = discard / 2;
<a name="l00451"></a>00451             <span class="keywordtype">int</span> length = coef.length - discard;
<a name="l00452"></a>00452             System.out.println(<span class="stringliteral">"pixbuff length = "</span> + pixbuff.length + <span class="stringliteral">", Coef.length="</span> + coef.length);
<a name="l00453"></a>00453             System.out.println(<span class="stringliteral">"ofs = "</span> + ofs + <span class="stringliteral">" length = "</span> + length);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 
<a name="l00456"></a>00456             <span class="keywordtype">int</span> pixelShift = (int)(width/2) - (int)(length/4);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458             System.out.println(<span class="stringliteral">"Shift="</span> + pixelShift);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460             <span class="comment">// convert to power (sum of the squares)</span>
<a name="l00461"></a>00461             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;length; i+=2)
<a name="l00462"></a>00462             {
<a name="l00463"></a>00463 
<a name="l00464"></a>00464                 <span class="keywordtype">double</span> realValue = coef[ofs+i];
<a name="l00465"></a>00465                 <span class="keywordtype">double</span> imagValue = coef[ofs+i+1];
<a name="l00466"></a>00466 
<a name="l00467"></a>00467                 <span class="keywordtype">int</span> power = (int) (realValue * realValue + 
<a name="l00468"></a>00468                         imagValue * imagValue);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                 <span class="keywordtype">int</span> pixel = (int) (power * scale);
<a name="l00471"></a>00471                 <span class="keywordflow">if</span> (pixel &gt; maxPixelValue)
<a name="l00472"></a>00472                     pixel = maxPixelValue;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474                 <span class="keywordtype">int</span> index = pixelShift +  pixIndex++;
<a name="l00475"></a>00475                 <span class="keywordflow">if</span>(index &lt; pixbuff.length)
<a name="l00476"></a>00476                 {
<a name="l00477"></a>00477                     pixbuff[index] = pixel;
<a name="l00478"></a>00478                 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480             }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     <span class="comment">// end class CoefConversion</span>
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 
<a name="l00497"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html">00497</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html">ComplexAmplitudes</a> 
<a name="l00498"></a>00498     {
<a name="l00499"></a>00499 
<a name="l00500"></a>00500         <span class="comment">//Usually the data is 1 subband, but can be more than one.</span>
<a name="l00501"></a>00501         <span class="comment">//As a sanity check limit the max number of subbands to 16.</span>
<a name="l00502"></a>00502         <span class="keywordtype">int</span> maxSubbands = 16;  <span class="comment">// sanity check</span>
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="comment">// data header</span>
<a name="l00505"></a>00505         <span class="keywordtype">double</span> rfCenterFrequency;
<a name="l00506"></a>00506         <span class="keywordtype">int</span> halfFrameNumber;
<a name="l00507"></a>00507         <span class="keywordtype">int</span> activityId;
<a name="l00508"></a>00508         <span class="keywordtype">double</span> hzPerSubband;
<a name="l00509"></a>00509         <span class="keywordtype">int</span> startSubbandId;
<a name="l00510"></a>00510         <span class="keywordtype">int</span> numberOfSubbands;
<a name="l00511"></a>00511         <span class="keywordtype">float</span> overSampling;
<a name="l00512"></a>00512         <span class="keywordtype">int</span> polarization;  <span class="comment">// defined as Polarization enum.  Assumed to be 32bit.</span>
<a name="l00513"></a>00513         <span class="keywordtype">int</span> compAmpsSubbandOffset = 0;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <span class="comment">// fixed length body, but is repeated numberOfSubbands times</span>
<a name="l00516"></a>00516         <span class="keywordtype">int</span> rawCoef[];
<a name="l00517"></a>00517 
<a name="l00525"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3b9ce8682a757ceda1136fe3d35ea892">00525</a>         <span class="keywordtype">double</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3b9ce8682a757ceda1136fe3d35ea892">coef</a>[];
<a name="l00526"></a>00526 
<a name="l00532"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#97c940635fc62882e4c43b1353d04017">00532</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#97c940635fc62882e4c43b1353d04017">unpackCoefsIntoDoubles</a>()
<a name="l00533"></a>00533         {
<a name="l00534"></a>00534             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3b9ce8682a757ceda1136fe3d35ea892">coef</a> = <span class="keyword">new</span> <span class="keywordtype">double</span>[rawCoef.length * 2];
<a name="l00535"></a>00535 
<a name="l00536"></a>00536             <span class="keywordtype">int</span> outIndex = 0;
<a name="l00537"></a>00537             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;rawCoef.length; ++i)
<a name="l00538"></a>00538             {
<a name="l00539"></a>00539                 <span class="comment">// coef's are:</span>
<a name="l00540"></a>00540                 <span class="comment">// RRRRIIII (4 bits real, 4 bits imaginary in 2's complement)</span>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                 <span class="keywordtype">int</span> realValue = (rawCoef[i] &amp; 0x000000f0) &gt;&gt; 4; 
<a name="l00543"></a>00543                 <span class="keywordflow">if</span> ((realValue &amp; 0x00000008) != 0)
<a name="l00544"></a>00544                     realValue |= 0xfffffff0;  <span class="comment">// sign extend</span>
<a name="l00545"></a>00545 
<a name="l00546"></a>00546                 <span class="keywordtype">int</span> imagValue = rawCoef[i] &amp; 0x0000000f;
<a name="l00547"></a>00547                 <span class="keywordflow">if</span> ((imagValue &amp; 0x00000008) != 0)
<a name="l00548"></a>00548                     imagValue |= 0xfffffff0;  <span class="comment">// sign extend</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3b9ce8682a757ceda1136fe3d35ea892">coef</a>[outIndex++] = realValue;
<a name="l00551"></a>00551                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3b9ce8682a757ceda1136fe3d35ea892">coef</a>[outIndex++] = imagValue;
<a name="l00552"></a>00552             }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         }
<a name="l00555"></a>00555 
<a name="l00562"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#6150f1d280c1398c358ec41362d79d5a">00562</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#6150f1d280c1398c358ec41362d79d5a">readHeader</a>(DataInputStream in) <span class="keywordflow">throws</span> java.io.IOException  
<a name="l00563"></a>00563         {
<a name="l00564"></a>00564 
<a name="l00565"></a>00565             <span class="comment">// read the header</span>
<a name="l00566"></a>00566             rfCenterFrequency = in.readDouble();
<a name="l00567"></a>00567             halfFrameNumber = in.readInt();
<a name="l00568"></a>00568             activityId = in.readInt();
<a name="l00569"></a>00569             hzPerSubband = in.readDouble();
<a name="l00570"></a>00570             startSubbandId = in.readInt();
<a name="l00571"></a>00571             numberOfSubbands = in.readInt();
<a name="l00572"></a>00572             overSampling = in.readFloat();
<a name="l00573"></a>00573             polarization = in.readInt();
<a name="l00574"></a>00574 
<a name="l00575"></a>00575             <span class="comment">// validate length of compamp value array</span>
<a name="l00576"></a>00576             <span class="keywordflow">if</span> (numberOfSubbands &lt; 1 || numberOfSubbands &gt; maxSubbands)
<a name="l00577"></a>00577             {
<a name="l00578"></a>00578                 System.out.println(
<a name="l00579"></a>00579                         <span class="stringliteral">"ERROR: subbands value "</span> + numberOfSubbands +
<a name="l00580"></a>00580                         <span class="stringliteral">" out of range.  Must be 1 - "</span> + maxSubbands);
<a name="l00581"></a>00581                 <span class="comment">//System.exit(1);</span>
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                 <span class="keywordflow">throw</span> <span class="keyword">new</span> java.io.IOException();
<a name="l00584"></a>00584             }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587 
<a name="l00593"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#86e5d3add6ffaf4f4a4b8cdfb989d3f4">00593</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#86e5d3add6ffaf4f4a4b8cdfb989d3f4">setSubbandOffset</a>(<span class="keywordtype">int</span> subbandOffset)
<a name="l00594"></a>00594         {
<a name="l00595"></a>00595             compAmpsSubbandOffset = subbandOffset;
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597 
<a name="l00604"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#d344ef7ecd8b4869927131b26ca8fac4">00604</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#d344ef7ecd8b4869927131b26ca8fac4">readSubbandData</a>(DataInputStream in) <span class="keywordflow">throws</span> java.io.IOException      
<a name="l00605"></a>00605         {
<a name="l00606"></a>00606 
<a name="l00607"></a>00607             <span class="comment">// TBD read numberOfSubbands times</span>
<a name="l00608"></a>00608 
<a name="l00609"></a>00609             <span class="comment">// read the variable length baseline value array    </span>
<a name="l00610"></a>00610             rawCoef = <span class="keyword">new</span> <span class="keywordtype">int</span>[MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME];
<a name="l00611"></a>00611             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME; ++i)
<a name="l00612"></a>00612             {
<a name="l00613"></a>00613                 rawCoef[i] = in.readUnsignedByte();
<a name="l00614"></a>00614             }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#97c940635fc62882e4c43b1353d04017">unpackCoefsIntoDoubles</a>();
<a name="l00617"></a>00617 
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620 
<a name="l00627"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#72c49bc81a5b04c8e46b5704e1da1a29">00627</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#72c49bc81a5b04c8e46b5704e1da1a29">skipSubbandData</a>(DataInputStream in) <span class="keywordflow">throws</span> java.io.IOException      
<a name="l00628"></a>00628         {
<a name="l00629"></a>00629 
<a name="l00630"></a>00630             <span class="comment">// read the variable length baseline value array    </span>
<a name="l00631"></a>00631             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME; ++i)
<a name="l00632"></a>00632             {
<a name="l00633"></a>00633                 <span class="keywordtype">int</span> discard = in.readUnsignedByte();
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00645"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#fd239ee973a28a261ef1c3a818473b75">00645</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#fd239ee973a28a261ef1c3a818473b75">read</a>(DataInputStream in) <span class="keywordflow">throws</span> java.io.IOException         
<a name="l00646"></a>00646         {
<a name="l00647"></a>00647 
<a name="l00648"></a>00648             <span class="comment">// assume requested subbandOffset runs from 0 to numberOfSubbands-1</span>
<a name="l00649"></a>00649 
<a name="l00650"></a>00650             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#6150f1d280c1398c358ec41362d79d5a">readHeader</a>(in);
<a name="l00651"></a>00651 
<a name="l00652"></a>00652             <span class="comment">// make sure the request doesn't exceed the actual</span>
<a name="l00653"></a>00653             <span class="comment">// number of subbands</span>
<a name="l00654"></a>00654 
<a name="l00655"></a>00655             <span class="keywordtype">int</span> subbandOffset = compAmpsSubbandOffset;
<a name="l00656"></a>00656             <span class="keywordflow">if</span> (subbandOffset &gt; numberOfSubbands-1)
<a name="l00657"></a>00657             {
<a name="l00658"></a>00658                 subbandOffset = 0;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660                 System.out.println(<span class="stringliteral">"subbandOffset exceeds number of available subbands"</span>);
<a name="l00661"></a>00661                 <span class="comment">// TBD warning</span>
<a name="l00662"></a>00662             }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664             <span class="comment">// pick out the requested subband (based on the subbandOffset) to display</span>
<a name="l00665"></a>00665 
<a name="l00666"></a>00666             <span class="comment">// skip the data before the desired subband</span>
<a name="l00667"></a>00667             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;subbandOffset &amp;&amp; i &lt; numberOfSubbands-1; ++i)
<a name="l00668"></a>00668             {
<a name="l00669"></a>00669                 startSubbandId++;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671                 <span class="comment">//System.out.println("skipping pre subband " + i);</span>
<a name="l00672"></a>00672                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#72c49bc81a5b04c8e46b5704e1da1a29">skipSubbandData</a>(in);
<a name="l00673"></a>00673             }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675             <span class="comment">// adjust the center frequency to match the selected</span>
<a name="l00676"></a>00676             <span class="comment">// subband.  the one in the header is defined to be the</span>
<a name="l00677"></a>00677             <span class="comment">// center freq of the first subband.</span>
<a name="l00678"></a>00678 
<a name="l00679"></a>00679             <span class="keywordtype">double</span> hzPerMHz = 1e6;
<a name="l00680"></a>00680             <span class="keywordtype">double</span> offsetMHz = (subbandOffset) * hzPerSubband / hzPerMHz;
<a name="l00681"></a>00681             rfCenterFrequency += offsetMHz;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683             <span class="comment">// read the desired subband</span>
<a name="l00684"></a>00684             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#d344ef7ecd8b4869927131b26ca8fac4">readSubbandData</a>(in);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686             <span class="comment">// skip the data after the desired subband</span>
<a name="l00687"></a>00687             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=subbandOffset+1; i&lt;=numberOfSubbands-1; ++i)
<a name="l00688"></a>00688             {
<a name="l00689"></a>00689                 <span class="comment">//System.out.println("skipping post subband " + i);</span>
<a name="l00690"></a>00690                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#72c49bc81a5b04c8e46b5704e1da1a29">skipSubbandData</a>(in);
<a name="l00691"></a>00691             }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695 
<a name="l00702"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3bca3fec4a68dc72446ee7cc72d1d3b8">00702</a>         <span class="keyword">private</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3bca3fec4a68dc72446ee7cc72d1d3b8">polIntToString</a>(<span class="keywordtype">int</span> pol)
<a name="l00703"></a>00703         {
<a name="l00704"></a>00704             String value;
<a name="l00705"></a>00705             <span class="keywordflow">switch</span> (pol)
<a name="l00706"></a>00706             {
<a name="l00707"></a>00707                 <span class="keywordflow">case</span> 0: value =<span class="stringliteral">"R"</span>;  <span class="comment">// right circular</span>
<a name="l00708"></a>00708                         <span class="keywordflow">break</span>;
<a name="l00709"></a>00709                 <span class="keywordflow">case</span> 1: value = <span class="stringliteral">"L"</span>; <span class="comment">// left circular</span>
<a name="l00710"></a>00710                         <span class="keywordflow">break</span>;
<a name="l00711"></a>00711                 <span class="keywordflow">case</span> 2: value = <span class="stringliteral">"B"</span>; <span class="comment">// both</span>
<a name="l00712"></a>00712                         <span class="keywordflow">break</span>;
<a name="l00713"></a>00713                 <span class="keywordflow">case</span> 3: value = <span class="stringliteral">"M"</span>; <span class="comment">// mixed</span>
<a name="l00714"></a>00714                         <span class="keywordflow">break</span>;
<a name="l00715"></a>00715                 <span class="keywordflow">default</span>: value = <span class="stringliteral">"?"</span>;
<a name="l00716"></a>00716                          <span class="keywordflow">break</span>;
<a name="l00717"></a>00717             }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719             <span class="keywordflow">return</span> value;
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721 
<a name="l00727"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#cc6ec565ff0ee4e989a6c3138b532063">00727</a>         <span class="keyword">public</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#cc6ec565ff0ee4e989a6c3138b532063">getPolAsString</a>()
<a name="l00728"></a>00728         {
<a name="l00729"></a>00729             <span class="keywordflow">return</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3bca3fec4a68dc72446ee7cc72d1d3b8">polIntToString</a>(polarization);
<a name="l00730"></a>00730         }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 
<a name="l00736"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#63f7600abf5875b5688b87be39aefc63">00736</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#63f7600abf5875b5688b87be39aefc63">printHeader</a>()
<a name="l00737"></a>00737         {
<a name="l00738"></a>00738 
<a name="l00739"></a>00739             System.out.println(
<a name="l00740"></a>00740                     <span class="stringliteral">"rfcenterFreq "</span> + rfCenterFrequency + <span class="stringliteral">" MHz,"</span> +
<a name="l00741"></a>00741                     <span class="stringliteral">" halfFrameNumber "</span> + halfFrameNumber + <span class="stringliteral">","</span> +
<a name="l00742"></a>00742                     <span class="stringliteral">" activityId "</span> + activityId + <span class="stringliteral">","</span> +
<a name="l00743"></a>00743                     <span class="stringliteral">" hzPerSubband "</span> + hzPerSubband + <span class="stringliteral">","</span> +
<a name="l00744"></a>00744                     <span class="stringliteral">" startSubbandId "</span> + startSubbandId + <span class="stringliteral">","</span> +
<a name="l00745"></a>00745                     <span class="stringliteral">" #subbands "</span> +  numberOfSubbands + <span class="stringliteral">","</span> +
<a name="l00746"></a>00746                     <span class="stringliteral">" overSampling "</span> + overSampling + <span class="stringliteral">","</span> +
<a name="l00747"></a>00747                     <span class="stringliteral">" pol "</span> + <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3bca3fec4a68dc72446ee7cc72d1d3b8">polIntToString</a>(polarization)
<a name="l00748"></a>00748                     );
<a name="l00749"></a>00749 
<a name="l00750"></a>00750         }
<a name="l00751"></a>00751 
<a name="l00755"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#e6117be6d998250ebb8be3e2d3b24915">00755</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#e6117be6d998250ebb8be3e2d3b24915">printBody</a>()
<a name="l00756"></a>00756         {
<a name="l00757"></a>00757             <span class="keywordtype">int</span> maxToPrint = 5;
<a name="l00758"></a>00758             System.out.print(<span class="stringliteral">"Compamp Values: "</span>);
<a name="l00759"></a>00759             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;maxToPrint &amp;&amp; i&lt;MAX_SUBBAND_BINS_PER_1KHZ_HALF_FRAME; ++i)
<a name="l00760"></a>00760             {
<a name="l00761"></a>00761                 System.out.print(<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#3b9ce8682a757ceda1136fe3d35ea892">coef</a>[i] + <span class="stringliteral">" "</span>);
<a name="l00762"></a>00762             }
<a name="l00763"></a>00763             System.out.println(<span class="stringliteral">""</span>);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765         }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     } <span class="comment">//End of ComplexAmplitudes class</span>
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 
<a name="l00774"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html">00774</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html">AverageComplexAmplitudes</a> 
<a name="l00775"></a>00775     {
<a name="l00776"></a>00776         <span class="keyword">private</span> <span class="keywordtype">double</span>[] powerSum = null;
<a name="l00777"></a>00777         <span class="keyword">private</span> <span class="keywordtype">double</span>[] powerAve = null;
<a name="l00778"></a>00778         <span class="keywordtype">int</span> numberOfFrames = 0;
<a name="l00779"></a>00779         <span class="keywordtype">int</span> arraySize = 0;
<a name="l00780"></a>00780 
<a name="l00786"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#5a59ae3aff9d0a0382c55ab77fa77cc8">00786</a>         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#5a59ae3aff9d0a0382c55ab77fa77cc8">AverageComplexAmplitudes</a>(<span class="keywordtype">int</span> arraySize)
<a name="l00787"></a>00787         {
<a name="l00788"></a>00788             this.arraySize = arraySize;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#554332d65ec1959ccb33d4c0680fc449">reset</a>();
<a name="l00791"></a>00791         }
<a name="l00792"></a>00792 
<a name="l00796"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#554332d65ec1959ccb33d4c0680fc449">00796</a>         <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#554332d65ec1959ccb33d4c0680fc449">reset</a>()
<a name="l00797"></a>00797         {
<a name="l00798"></a>00798             numberOfFrames = 0;
<a name="l00799"></a>00799             powerSum = <span class="keyword">new</span> <span class="keywordtype">double</span>[arraySize];
<a name="l00800"></a>00800             powerAve = <span class="keyword">new</span> <span class="keywordtype">double</span>[arraySize];
<a name="l00801"></a>00801         }
<a name="l00802"></a>00802 
<a name="l00809"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#411726466f3ccd2ab9afe2d6e5fbdf37">00809</a>         <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#411726466f3ccd2ab9afe2d6e5fbdf37">add</a>(<span class="keywordtype">double</span>[] fftValues)
<a name="l00810"></a>00810         {
<a name="l00811"></a>00811             numberOfFrames++;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             <span class="comment">// find the sum &amp; the average for each fftValue</span>
<a name="l00814"></a>00814             <span class="keywordtype">int</span> j=0;
<a name="l00815"></a>00815             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;fftValues.length; i+=2)
<a name="l00816"></a>00816             {
<a name="l00817"></a>00817 
<a name="l00818"></a>00818                 <span class="keywordtype">double</span> realValue = fftValues[i];
<a name="l00819"></a>00819                 <span class="keywordtype">double</span> imagValue = fftValues[i+1];
<a name="l00820"></a>00820 
<a name="l00821"></a>00821                 <span class="keywordtype">double</span> power = realValue * realValue + 
<a name="l00822"></a>00822                     imagValue * imagValue;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824                 powerSum[j] += power;
<a name="l00825"></a>00825                 powerAve[j] = powerSum[j] / numberOfFrames;
<a name="l00826"></a>00826                 j++;
<a name="l00827"></a>00827             }
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829 
<a name="l00835"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#dc2f52048a55fc921f4adc54d7ad12af">00835</a>         <span class="keywordtype">double</span>[] <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html#dc2f52048a55fc921f4adc54d7ad12af">getAverageValues</a>()
<a name="l00836"></a>00836         {
<a name="l00837"></a>00837             <span class="keywordflow">return</span> powerAve;
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     } <span class="comment">//End of AverageComplexAmplitudes class.</span>
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 
<a name="l00861"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#8db7f74cbaed8dd6e14f0a5c1374c3a4">00861</a>     <span class="keyword">public</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#8db7f74cbaed8dd6e14f0a5c1374c3a4">WaterfallDisplay</a>(<span class="keywordtype">boolean</span> usingGui,
<a name="l00862"></a>00862             JFrame mainGuiFrame, 
<a name="l00863"></a>00863             String inFilename,
<a name="l00864"></a>00864             String outFilename,
<a name="l00865"></a>00865             <span class="keywordtype">int</span> subbandOffset,
<a name="l00866"></a>00866             <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, 
<a name="l00867"></a>00867             <span class="keywordtype">float</span> pixelScaleFactor,  <span class="keywordtype">float</span> pixelOffsetFactor,
<a name="l00868"></a>00868             <span class="keywordtype">int</span> resolutionHz,
<a name="l00869"></a>00869             <span class="keywordtype">boolean</span> slowPlay,
<a name="l00870"></a>00870             <span class="keywordtype">boolean</span> repeatPlay,
<a name="l00871"></a>00871             String title)
<a name="l00872"></a>00872     {
<a name="l00873"></a>00873         this.usingGui = usingGui;
<a name="l00874"></a>00874         this.mainGuiFrame = mainGuiFrame;
<a name="l00875"></a>00875         this.inFilename = inFilename;
<a name="l00876"></a>00876         this.outFilename = outFilename;
<a name="l00877"></a>00877         this.subbandOffset = subbandOffset;
<a name="l00878"></a>00878         this.width = width;
<a name="l00879"></a>00879         this.height = height;
<a name="l00880"></a>00880         this.pixelScaleFactor = pixelScaleFactor;
<a name="l00881"></a>00881         this.pixelOffsetFactor = pixelOffsetFactor;
<a name="l00882"></a>00882         this.title = title;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884         <span class="keywordflow">if</span> (usingGui)
<a name="l00885"></a>00885         {
<a name="l00886"></a>00886             this.currentFileText = <span class="keyword">new</span> JLabel(<span class="stringliteral">""</span>);
<a name="l00887"></a>00887             this.aveCompAmpsCurrentFileText = <span class="keyword">new</span> JLabel(<span class="stringliteral">""</span>);
<a name="l00888"></a>00888         }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890         this.displayResolution = resolutionHz;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         this.slowPlay = slowPlay;
<a name="l00893"></a>00893         this.repeatPlay = repeatPlay;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         origBuffImage = <span class="keyword">new</span> BufferedImage(width, height, imageType);
<a name="l00897"></a>00897         scaledBuffImage = <span class="keyword">new</span> BufferedImage(width, height, imageType);
<a name="l00898"></a>00898         compAmps = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html">ComplexAmplitudes</a>();
<a name="l00899"></a>00899         compAmps.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#86e5d3add6ffaf4f4a4b8cdfb989d3f4">setSubbandOffset</a>(this.subbandOffset);
<a name="l00900"></a>00900         coefConversion = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CoefConversion.html">CoefConversion</a>();
<a name="l00901"></a>00901         averageComplexAmplitudes = 
<a name="l00902"></a>00902             <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1AverageComplexAmplitudes.html">AverageComplexAmplitudes</a>(MAX_SUBBAND_BINS_PER_1HZ_HALF_FRAME);
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904 
<a name="l00915"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html">00915</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html">FileScanner</a> <span class="keyword">extends</span> Thread 
<a name="l00916"></a>00916     {
<a name="l00917"></a>00917 
<a name="l00918"></a>00918         <span class="keywordtype">int</span> width;
<a name="l00919"></a>00919         <span class="keywordtype">int</span> height;
<a name="l00920"></a>00920         String filename;
<a name="l00921"></a>00921         DataInputStream in;
<a name="l00922"></a>00922         <span class="comment">// transform: shift image by 1 Y pixel</span>
<a name="l00923"></a>00923         AffineTransformOp aftOpShift1LineDown;
<a name="l00924"></a>00924         <span class="comment">// transform: copy image unchanged</span>
<a name="l00925"></a>00925         AffineTransformOp aftOpCopy;
<a name="l00926"></a>00926         BufferedImage shiftedBuffImage;
<a name="l00927"></a>00927         <span class="keywordtype">int</span> imageRowCount;
<a name="l00928"></a>00928 
<a name="l00936"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#80c5ca048c8d316964ff0b08d9bb335b">00936</a>         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#80c5ca048c8d316964ff0b08d9bb335b">FileScanner</a>(String filename, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)
<a name="l00937"></a>00937         {
<a name="l00938"></a>00938 
<a name="l00939"></a>00939             this.width = width;
<a name="l00940"></a>00940             this.height = height;
<a name="l00941"></a>00941             this.filename = filename;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943             <span class="comment">// create transform to shift orig image down by 1 line (1 Y pixel)</span>
<a name="l00944"></a>00944             AffineTransform aftShift = <span class="keyword">new</span> AffineTransform();
<a name="l00945"></a>00945             aftShift.setToTranslation(0.0, 1.0);  <span class="comment">// shift y </span>
<a name="l00946"></a>00946             aftOpShift1LineDown = <span class="keyword">new</span> AffineTransformOp(aftShift, null);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948             <span class="comment">// create transform to copy orig image, unchanged</span>
<a name="l00949"></a>00949             AffineTransform aftCopy = <span class="keyword">new</span> AffineTransform();
<a name="l00950"></a>00950             aftCopy.setToTranslation(0.0, 0.0);  <span class="comment">// no shift</span>
<a name="l00951"></a>00951             aftOpCopy = <span class="keyword">new</span> AffineTransformOp(aftCopy, null);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953             <span class="comment">// make empty temp image</span>
<a name="l00954"></a>00954             shiftedBuffImage = <span class="keyword">new</span> BufferedImage(width, height, 
<a name="l00955"></a>00955                     imageType);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957             start();
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959 
<a name="l00965"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#88314000e765c6c8a51dc36961f1a0ef">00965</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#88314000e765c6c8a51dc36961f1a0ef">openNewFile</a>(String filename)
<a name="l00966"></a>00966         {
<a name="l00967"></a>00967             this.filename = filename;
<a name="l00968"></a>00968             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#00c184e981bba1a3471b7fa0509e51aa">openFile</a>();
<a name="l00969"></a>00969         }
<a name="l00970"></a>00970 
<a name="l00974"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#00c184e981bba1a3471b7fa0509e51aa">00974</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#00c184e981bba1a3471b7fa0509e51aa">openFile</a>()
<a name="l00975"></a>00975         {
<a name="l00976"></a>00976             <span class="keywordflow">if</span> (filename != <span class="stringliteral">""</span>)
<a name="l00977"></a>00977             {
<a name="l00978"></a>00978 
<a name="l00979"></a>00979                 <span class="comment">//System.out.println("openFile called");</span>
<a name="l00980"></a>00980 
<a name="l00981"></a>00981 
<a name="l00982"></a>00982                 <span class="keywordflow">try</span> 
<a name="l00983"></a>00983                 {
<a name="l00984"></a>00984                     <span class="comment">// close previously open stream</span>
<a name="l00985"></a>00985                     <span class="comment">// TBD synchronize this?</span>
<a name="l00986"></a>00986                     <span class="keywordflow">if</span> (in != null)
<a name="l00987"></a>00987                     {
<a name="l00988"></a>00988                         in.close();
<a name="l00989"></a>00989                         in = null;
<a name="l00990"></a>00990                     }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992                     <span class="comment">// remove any previously stored complex amplitude data</span>
<a name="l00993"></a>00993                     <span class="comment">// (used for pipelining fft conversion to 1Hz data)</span>
<a name="l00994"></a>00994 
<a name="l00995"></a>00995                     imageRowCount = 0;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997                     averageComplexAmplitudes.reset();
<a name="l00998"></a>00998                     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b3cc562cbf155d5a76e25c1cf1a03551">clearPlot</a>();
<a name="l00999"></a>00999 
<a name="l01000"></a>01000                     coefConversion.startNewDataStream();
<a name="l01001"></a>01001 
<a name="l01002"></a>01002                     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#d5a4f3cbb2e3574d64a38db0f9f086ae">separatePreviouslyDisplayedData</a>();
<a name="l01003"></a>01003 
<a name="l01004"></a>01004                     in = <span class="keyword">new</span> DataInputStream(
<a name="l01005"></a>01005                             <span class="keyword">new</span> BufferedInputStream(
<a name="l01006"></a>01006                                 <span class="keyword">new</span> FileInputStream(filename)));
<a name="l01007"></a>01007 
<a name="l01008"></a>01008                 }
<a name="l01009"></a>01009                 <span class="keywordflow">catch</span> (IOException e)
<a name="l01010"></a>01010                 {
<a name="l01011"></a>01011                     System.out.println(e);
<a name="l01012"></a>01012                 }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014             }
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016 
<a name="l01020"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#c3408607a403ce8ad20f58b4897bc415">01020</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#c3408607a403ce8ad20f58b4897bc415">sleep</a>()
<a name="l01021"></a>01021         {
<a name="l01022"></a>01022             <span class="keywordflow">try</span> 
<a name="l01023"></a>01023             {
<a name="l01024"></a>01024                 <span class="keywordtype">int</span> latency = 200;  <span class="comment">//mS</span>
<a name="l01025"></a>01025                 Thread.sleep(latency);
<a name="l01026"></a>01026             }
<a name="l01027"></a>01027             <span class="keywordflow">catch</span> (InterruptedException e)
<a name="l01028"></a>01028             {
<a name="l01029"></a>01029                 <span class="comment">// Interrupt may be thrown manually by stop()</span>
<a name="l01030"></a>01030             }
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032 
<a name="l01037"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#d5a4f3cbb2e3574d64a38db0f9f086ae">01037</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#d5a4f3cbb2e3574d64a38db0f9f086ae">separatePreviouslyDisplayedData</a>() 
<a name="l01038"></a>01038         {
<a name="l01039"></a>01039 
<a name="l01040"></a>01040             <span class="keywordtype">int</span> lineBrightnessPixelValue = 40;
<a name="l01041"></a>01041             <span class="keywordtype">int</span> nRows = 1;
<a name="l01042"></a>01042 
<a name="l01043"></a>01043             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#1de7c83863ca7b7cc907e1e17019ca29">addRowsOfConstantBrightness</a>(lineBrightnessPixelValue,
<a name="l01044"></a>01044                     nRows);
<a name="l01045"></a>01045         }
<a name="l01046"></a>01046 
<a name="l01053"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#1de7c83863ca7b7cc907e1e17019ca29">01053</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#1de7c83863ca7b7cc907e1e17019ca29">addRowsOfConstantBrightness</a>(<span class="keywordtype">int</span> brightnessPixelValue,
<a name="l01054"></a>01054                 <span class="keywordtype">int</span> nRows) 
<a name="l01055"></a>01055         {
<a name="l01056"></a>01056             <span class="comment">// make a solid line</span>
<a name="l01057"></a>01057             <span class="keywordtype">int</span> rowSize = width;
<a name="l01058"></a>01058             <span class="keywordtype">int</span> [] pixrow = <span class="keyword">new</span> <span class="keywordtype">int</span>[rowSize];
<a name="l01059"></a>01059             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;pixrow.length; ++i) 
<a name="l01060"></a>01060             {
<a name="l01061"></a>01061                 pixrow[i] = brightnessPixelValue;
<a name="l01062"></a>01062             }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; nRows; ++i) 
<a name="l01065"></a>01065             {
<a name="l01066"></a>01066                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b11def9da7d6b1ab0ceb1b8c6cc84ecd">addPixelRowToImage</a>(pixrow);
<a name="l01067"></a>01067             }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>();
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071 
<a name="l01077"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b11def9da7d6b1ab0ceb1b8c6cc84ecd">01077</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b11def9da7d6b1ab0ceb1b8c6cc84ecd">addPixelRowToImage</a>(<span class="keywordtype">int</span>[] pixrow)
<a name="l01078"></a>01078         {
<a name="l01079"></a>01079             <span class="comment">// shift orig buff down by one pixel</span>
<a name="l01080"></a>01080             aftOpShift1LineDown.filter(origBuffImage, shiftedBuffImage);
<a name="l01081"></a>01081 
<a name="l01082"></a>01082             <span class="comment">// add in new line at the top</span>
<a name="l01083"></a>01083             <span class="keywordtype">int</span> nrows = 1;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085             System.out.println(<span class="stringliteral">""</span> + pixrow[0] + <span class="stringliteral">","</span> + pixrow[1] + <span class="stringliteral">","</span> + pixrow[2] + <span class="stringliteral">","</span> + pixrow[3]);
<a name="l01086"></a>01086             shiftedBuffImage.getRaster().setPixels(0, 0, width, nrows, pixrow);
<a name="l01087"></a>01087 
<a name="l01088"></a>01088             <span class="comment">// copy shifted image back to orig</span>
<a name="l01089"></a>01089             aftOpCopy.filter(shiftedBuffImage, origBuffImage);
<a name="l01090"></a>01090 
<a name="l01091"></a>01091             imageRowCount++;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>();
<a name="l01094"></a>01094         }
<a name="l01095"></a>01095 
<a name="l01102"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#8ed68955e3ad1e85fce730169830f5e2">01102</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#8ed68955e3ad1e85fce730169830f5e2">updateDisplayHeaders</a>(<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html">ComplexAmplitudes</a> compAmps)
<a name="l01103"></a>01103         {
<a name="l01104"></a>01104 
<a name="l01105"></a>01105 
<a name="l01106"></a>01106             DecimalFormat rfCenterFreqFormatter =
<a name="l01107"></a>01107                 <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000.000000 MHz "</span>);
<a name="l01108"></a>01108             DecimalFormat halfFrameFormatter =
<a name="l01109"></a>01109                 <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000 "</span>);
<a name="l01110"></a>01110             DecimalFormat subbandNumberFormatter =
<a name="l01111"></a>01111                 <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000 "</span>);
<a name="l01112"></a>01112             DecimalFormat bandwidthFormatter = 
<a name="l01113"></a>01113                 <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"000.0 Hz "</span>);
<a name="l01114"></a>01114             DecimalFormat activityIdFormatter = 
<a name="l01115"></a>01115                 <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000 "</span>);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117             <span class="keywordflow">if</span> (usingGui) 
<a name="l01118"></a>01118             {
<a name="l01119"></a>01119                 <span class="comment">// update widgets</span>
<a name="l01120"></a>01120 
<a name="l01121"></a>01121                 polValueLabel.setText(<span class="stringliteral">""</span> + compAmps.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ComplexAmplitudes.html#cc6ec565ff0ee4e989a6c3138b532063">getPolAsString</a>() + <span class="stringliteral">" "</span>);
<a name="l01122"></a>01122 
<a name="l01123"></a>01123                 subbandNumberValueLabel.setText(
<a name="l01124"></a>01124                         subbandNumberFormatter.format(compAmps.startSubbandId));
<a name="l01125"></a>01125 
<a name="l01126"></a>01126                 rfCenterFreqValueLabel.setText(
<a name="l01127"></a>01127                         rfCenterFreqFormatter.format(compAmps.rfCenterFrequency));
<a name="l01128"></a>01128 
<a name="l01129"></a>01129                 halfFrameNumberValueLabel.setText(
<a name="l01130"></a>01130                         halfFrameFormatter.format(compAmps.halfFrameNumber));
<a name="l01131"></a>01131 
<a name="l01132"></a>01132                 bandwidthValueLabel.setText(
<a name="l01133"></a>01133                         bandwidthFormatter.format(compAmps.hzPerSubband));
<a name="l01134"></a>01134 
<a name="l01135"></a>01135                 aveCompAmpsSubbandNumberValueLabel.setText(
<a name="l01136"></a>01136                         subbandNumberFormatter.format(compAmps.startSubbandId));
<a name="l01137"></a>01137 
<a name="l01138"></a>01138                 aveCompAmpsBandwidthValueLabel.setText(
<a name="l01139"></a>01139                         bandwidthFormatter.format(compAmps.hzPerSubband));
<a name="l01140"></a>01140 
<a name="l01141"></a>01141                 activityIdValueLabel.setText(
<a name="l01142"></a>01142                         activityIdFormatter.format(compAmps.activityId));
<a name="l01143"></a>01143             }
<a name="l01144"></a>01144             <span class="keywordflow">else</span> 
<a name="l01145"></a>01145             {
<a name="l01146"></a>01146 
<a name="l01147"></a>01147                 <span class="comment">// Not in GUI mode, draw directly on image</span>
<a name="l01148"></a>01148 
<a name="l01149"></a>01149                 String header1 = <span class="stringliteral">"Waterfall: "</span>;
<a name="l01150"></a>01150                 <span class="keywordflow">if</span> (title.equals(<span class="stringliteral">""</span>))
<a name="l01151"></a>01151                 {
<a name="l01152"></a>01152                     <span class="comment">// use last part of filename as title</span>
<a name="l01153"></a>01153                     header1 += <span class="stringliteral">" File: "</span> + <span class="keyword">new</span> File(inFilename).getName();  
<a name="l01154"></a>01154                 }
<a name="l01155"></a>01155                 <span class="keywordflow">else</span>
<a name="l01156"></a>01156                 {
<a name="l01157"></a>01157                     header1 += title;
<a name="l01158"></a>01158                 }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160                 String header2 = <span class="stringliteral">"Center Freq: "</span>
<a name="l01161"></a>01161                     + rfCenterFreqFormatter.format(compAmps.rfCenterFrequency)
<a name="l01162"></a>01162                     + <span class="stringliteral">"  Subband: "</span>
<a name="l01163"></a>01163                     + subbandNumberFormatter.format(compAmps.startSubbandId)
<a name="l01164"></a>01164                     + <span class="stringliteral">"  BW: "</span>
<a name="l01165"></a>01165                     + bandwidthFormatter.format(compAmps.hzPerSubband)
<a name="l01166"></a>01166                     + <span class="stringliteral">"  #Half Frames: "</span>
<a name="l01167"></a>01167                     + halfFrameFormatter.format(compAmps.halfFrameNumber)
<a name="l01168"></a>01168                     + <span class="stringliteral">"  ActId: "</span>
<a name="l01169"></a>01169                     + activityIdFormatter.format(compAmps.activityId);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171                 <span class="comment">// make room in top of buffer for header labels</span>
<a name="l01172"></a>01172                 <span class="comment">// line separator</span>
<a name="l01173"></a>01173                 <span class="keywordtype">int</span> pixelBrightness=100;
<a name="l01174"></a>01174                 <span class="keywordtype">int</span> nRows=1;
<a name="l01175"></a>01175                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#1de7c83863ca7b7cc907e1e17019ca29">addRowsOfConstantBrightness</a>(pixelBrightness, nRows);
<a name="l01176"></a>01176 
<a name="l01177"></a>01177                 Graphics2D g2d = scaledBuffImage.createGraphics();
<a name="l01178"></a>01178                 <span class="keywordtype">int</span> fontHeight = g2d.getFontMetrics().getHeight();
<a name="l01179"></a>01179 
<a name="l01180"></a>01180                 <span class="comment">//System.out.println("font height is: " + fontHeight);</span>
<a name="l01181"></a>01181 
<a name="l01182"></a>01182                 <span class="comment">// space for header labels</span>
<a name="l01183"></a>01183                 pixelBrightness=0; 
<a name="l01184"></a>01184                 <span class="keywordtype">int</span> nHeaderLines=2;
<a name="l01185"></a>01185                 <span class="keywordtype">int</span> nWaterfallRows=nHeaderLines * fontHeight;
<a name="l01186"></a>01186                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#1de7c83863ca7b7cc907e1e17019ca29">addRowsOfConstantBrightness</a>(pixelBrightness, nWaterfallRows);
<a name="l01187"></a>01187 
<a name="l01188"></a>01188                 <span class="keywordtype">int</span> headerX = 5;
<a name="l01189"></a>01189                 <span class="keywordtype">int</span> headerY = g2d.getFontMetrics().getAscent();
<a name="l01190"></a>01190                 g2d.drawString(header1, headerX, headerY);
<a name="l01191"></a>01191                 headerY += fontHeight;
<a name="l01192"></a>01192                 g2d.drawString(header2, headerX, headerY);
<a name="l01193"></a>01193 
<a name="l01194"></a>01194             }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196         }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198 
<a name="l01204"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#762bfab39ab75b195687edad5ecf1f43">01204</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#762bfab39ab75b195687edad5ecf1f43">plotAverageComplexAmplitudes</a>(<span class="keywordtype">double</span>[] fftValues)
<a name="l01205"></a>01205         {
<a name="l01206"></a>01206 
<a name="l01207"></a>01207             <span class="keywordflow">if</span> (usingGui)
<a name="l01208"></a>01208             {
<a name="l01209"></a>01209 
<a name="l01210"></a>01210                 averageComplexAmplitudes.add(fftValues);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#7e540f623e46906121c6dd0e1349562f">plotComplexAmplitudes</a>(averageComplexAmplitudes.getAverageValues());
<a name="l01213"></a>01213             }
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215 
<a name="l01221"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#7e540f623e46906121c6dd0e1349562f">01221</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#7e540f623e46906121c6dd0e1349562f">plotComplexAmplitudes</a>(<span class="keywordtype">double</span>[] values)
<a name="l01222"></a>01222         {
<a name="l01223"></a>01223             <span class="comment">//System.out.println("plotComplexAmplitudes");</span>
<a name="l01224"></a>01224 
<a name="l01225"></a>01225             <span class="keywordtype">int</span> datasetIndex = 0;
<a name="l01226"></a>01226             <span class="keywordtype">boolean</span> connected = <span class="keyword">true</span>;
<a name="l01227"></a>01227             <span class="keywordtype">double</span> xvalue;
<a name="l01228"></a>01228             <span class="keywordtype">double</span> yvalue;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b3cc562cbf155d5a76e25c1cf1a03551">clearPlot</a>();
<a name="l01231"></a>01231 
<a name="l01232"></a>01232             compAmps.printHeader();
<a name="l01233"></a>01233 
<a name="l01234"></a>01234             <span class="keywordtype">int</span> discard = (int) (values.length * compAmps.overSampling);
<a name="l01235"></a>01235             <span class="keywordtype">int</span> start = discard / 2;
<a name="l01236"></a>01236             <span class="keywordtype">int</span> end = values.length - discard / 2;
<a name="l01237"></a>01237             <span class="comment">// go through data array &amp; plot all the points</span>
<a name="l01238"></a>01238             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; values.length; ++i)
<a name="l01239"></a>01239             {
<a name="l01240"></a>01240                 xvalue = i;  <span class="comment">// use index for now</span>
<a name="l01241"></a>01241                 <span class="keywordflow">if</span> (i &lt; start || i &gt;= end)
<a name="l01242"></a>01242                     yvalue = 0;
<a name="l01243"></a>01243                 <span class="keywordflow">else</span>
<a name="l01244"></a>01244                     yvalue = values[i];
<a name="l01245"></a>01245                 readoutPlot.addPoint(datasetIndex, xvalue, yvalue, connected);
<a name="l01246"></a>01246             }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248             <span class="comment">// add a final point at the end with a zero Y value,</span>
<a name="l01249"></a>01249             <span class="comment">// to force the y axis to display full scale</span>
<a name="l01250"></a>01250             xvalue = values.length;
<a name="l01251"></a>01251             yvalue = 0;
<a name="l01252"></a>01252             readoutPlot.addPoint(datasetIndex, xvalue, yvalue, connected);
<a name="l01253"></a>01253 
<a name="l01254"></a>01254             <span class="comment">// properly scale the plot to fit this data</span>
<a name="l01255"></a>01255             readoutPlot.fillPlot();  
<a name="l01256"></a>01256 
<a name="l01257"></a>01257         }
<a name="l01258"></a>01258 
<a name="l01262"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b3cc562cbf155d5a76e25c1cf1a03551">01262</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b3cc562cbf155d5a76e25c1cf1a03551">clearPlot</a>()
<a name="l01263"></a>01263         {
<a name="l01264"></a>01264             <span class="keywordtype">int</span> datasetIndex = 0;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266             <span class="keywordflow">if</span> (usingGui)
<a name="l01267"></a>01267             {
<a name="l01268"></a>01268                 readoutPlot.clear(datasetIndex);
<a name="l01269"></a>01269             }
<a name="l01270"></a>01270         }
<a name="l01271"></a>01271 
<a name="l01275"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#fef01fb904fef058326ee483a554e79e">01275</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#fef01fb904fef058326ee483a554e79e">slowPlaySleep</a>()
<a name="l01276"></a>01276         {
<a name="l01277"></a>01277             <span class="keywordflow">try</span> 
<a name="l01278"></a>01278             {
<a name="l01279"></a>01279                 <span class="keywordtype">int</span> latency = 750;  <span class="comment">//mS, simulate data delivery rate</span>
<a name="l01280"></a>01280 
<a name="l01281"></a>01281                 Thread.sleep(latency);
<a name="l01282"></a>01282             }
<a name="l01283"></a>01283             <span class="keywordflow">catch</span> (InterruptedException e)
<a name="l01284"></a>01284             {
<a name="l01285"></a>01285                 <span class="comment">// Interrupt may be thrown manually by stop()</span>
<a name="l01286"></a>01286             }
<a name="l01287"></a>01287         }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 
<a name="l01293"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#53602aae03a41224922c02dfc64ca525">01293</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#53602aae03a41224922c02dfc64ca525">saveWaterfallAsJpegFile</a>() throws java.io.IOException
<a name="l01294"></a>01294         {
<a name="l01295"></a>01295 
<a name="l01296"></a>01296             <span class="comment">// Crop the image buffer so that any blank</span>
<a name="l01297"></a>01297             <span class="comment">// areas at the bottom are eliminated.</span>
<a name="l01298"></a>01298             BufferedImage croppedWaterfall = 
<a name="l01299"></a>01299                 scaledBuffImage.getSubimage(
<a name="l01300"></a>01300                         0,0,scaledBuffImage.getWidth(),
<a name="l01301"></a>01301                         imageRowCount);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303             File jpegFile = <span class="keyword">new</span> File(outFilename);
<a name="l01304"></a>01304             ImageIO.write(croppedWaterfall, <span class="stringliteral">"jpg"</span>, jpegFile);
<a name="l01305"></a>01305         }
<a name="l01306"></a>01306 
<a name="l01310"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#65890a359a115ad629778939bf55e95f">01310</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#65890a359a115ad629778939bf55e95f">run</a>()
<a name="l01311"></a>01311         {
<a name="l01312"></a>01312 
<a name="l01313"></a>01313             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#00c184e981bba1a3471b7fa0509e51aa">openFile</a>();
<a name="l01314"></a>01314 
<a name="l01315"></a>01315             <span class="keywordtype">int</span> rowSize = width;
<a name="l01316"></a>01316             <span class="keywordtype">int</span> count = 0;
<a name="l01317"></a>01317             <span class="keywordtype">int</span>[] pixbuff = <span class="keyword">new</span> <span class="keywordtype">int</span>[rowSize];
<a name="l01318"></a>01318             <span class="keywordtype">double</span>[] fftValues;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320             <span class="keywordtype">boolean</span> continueRunning = <span class="keyword">true</span>;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322             <span class="keywordflow">while</span> (continueRunning)
<a name="l01323"></a>01323             {
<a name="l01324"></a>01324 
<a name="l01325"></a>01325                 <span class="keywordflow">try</span> 
<a name="l01326"></a>01326                 {
<a name="l01327"></a>01327 
<a name="l01328"></a>01328                     <span class="comment">// Keep reading pixel data.  When enough</span>
<a name="l01329"></a>01329                     <span class="comment">// for a row shows up, then add it to the display.</span>
<a name="l01330"></a>01330 
<a name="l01331"></a>01331                     <span class="keywordtype">int</span> x = 0;
<a name="l01332"></a>01332                     <span class="keywordtype">int</span> minBytesToRead = 1;
<a name="l01333"></a>01333                     <span class="keywordflow">while</span> (in != null &amp;&amp; (in.available() &gt;= minBytesToRead))   
<a name="l01334"></a>01334                     {
<a name="l01335"></a>01335 
<a name="l01336"></a>01336                         <span class="keywordflow">if</span> (readGrayscalePixels) 
<a name="l01337"></a>01337                         {                   
<a name="l01338"></a>01338                             <span class="keywordtype">int</span> rawByte = in.readUnsignedByte();
<a name="l01339"></a>01339                             pixbuff[x++] = rawByte;
<a name="l01340"></a>01340 
<a name="l01341"></a>01341                             count++;
<a name="l01342"></a>01342                             <span class="keywordflow">if</span> (x &gt;= rowSize)
<a name="l01343"></a>01343                             {
<a name="l01344"></a>01344                                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b11def9da7d6b1ab0ceb1b8c6cc84ecd">addPixelRowToImage</a>(pixbuff);
<a name="l01345"></a>01345                                 x = 0;
<a name="l01346"></a>01346                             }
<a name="l01347"></a>01347                         } 
<a name="l01348"></a>01348                         <span class="keywordflow">else</span> 
<a name="l01349"></a>01349                         {
<a name="l01350"></a>01350 
<a name="l01351"></a>01351                             <span class="keywordflow">if</span> (slowPlay) 
<a name="l01352"></a>01352                             {
<a name="l01353"></a>01353                                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#fef01fb904fef058326ee483a554e79e">slowPlaySleep</a>();
<a name="l01354"></a>01354                             }
<a name="l01355"></a>01355 
<a name="l01356"></a>01356                             <span class="comment">//read in the data</span>
<a name="l01357"></a>01357                             compAmps.read(in);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359                             <span class="keywordflow">if</span> (usingGui) 
<a name="l01360"></a>01360                             {
<a name="l01361"></a>01361                                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#8ed68955e3ad1e85fce730169830f5e2">updateDisplayHeaders</a>(compAmps);
<a name="l01362"></a>01362                             }                          
<a name="l01363"></a>01363 
<a name="l01364"></a>01364                             <span class="keywordtype">double</span>[] timeSamples = compAmps.coef;
<a name="l01365"></a>01365 
<a name="l01366"></a>01366 
<a name="l01367"></a>01367                             <span class="keywordflow">if</span> (displayResolution == 1) 
<a name="l01368"></a>01368                             {
<a name="l01369"></a>01369 
<a name="l01370"></a>01370                                 fftValues = 
<a name="l01371"></a>01371                                     coefConversion.convertCoefsTo1HzFreqValues(
<a name="l01372"></a>01372                                             timeSamples);
<a name="l01373"></a>01373                             }
<a name="l01374"></a>01374                             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(displayResolution == 2)
<a name="l01375"></a>01375                             {
<a name="l01376"></a>01376 
<a name="l01377"></a>01377                                 fftValues = 
<a name="l01378"></a>01378                                     coefConversion.convertCoefsTo2HzFreqValues(
<a name="l01379"></a>01379                                             timeSamples);
<a name="l01380"></a>01380                             }
<a name="l01381"></a>01381                             <span class="keywordflow">else</span> <span class="comment">//4</span>
<a name="l01382"></a>01382                             {
<a name="l01383"></a>01383 
<a name="l01384"></a>01384                                 fftValues = 
<a name="l01385"></a>01385                                     coefConversion.convertCoefsTo4HzFreqValues(
<a name="l01386"></a>01386                                             timeSamples);
<a name="l01387"></a>01387                             }
<a name="l01388"></a>01388 
<a name="l01389"></a>01389                             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#762bfab39ab75b195687edad5ecf1f43">plotAverageComplexAmplitudes</a>(fftValues);
<a name="l01390"></a>01390 
<a name="l01391"></a>01391                             coefConversion.convertFFTValuesToPixels(
<a name="l01392"></a>01392                                     fftValues, pixbuff);
<a name="l01393"></a>01393 
<a name="l01394"></a>01394                             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#b11def9da7d6b1ab0ceb1b8c6cc84ecd">addPixelRowToImage</a>(pixbuff);
<a name="l01395"></a>01395 
<a name="l01396"></a>01396 
<a name="l01397"></a>01397                         }
<a name="l01398"></a>01398                     }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400                     <span class="keywordflow">if</span> (! usingGui) 
<a name="l01401"></a>01401                     {
<a name="l01402"></a>01402 
<a name="l01403"></a>01403                         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#8ed68955e3ad1e85fce730169830f5e2">updateDisplayHeaders</a>(compAmps);
<a name="l01404"></a>01404 
<a name="l01405"></a>01405                         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#53602aae03a41224922c02dfc64ca525">saveWaterfallAsJpegFile</a>();
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                         continueRunning = <span class="keyword">false</span>;
<a name="l01408"></a>01408 
<a name="l01409"></a>01409                     }
<a name="l01410"></a>01410 
<a name="l01411"></a>01411                     <span class="comment">// Detecting file truncation in this</span>
<a name="l01412"></a>01412                     <span class="comment">// way is not documented but seems to work.</span>
<a name="l01413"></a>01413                     <span class="comment">// TBD: come up with a better method</span>
<a name="l01414"></a>01414                     <span class="keywordflow">if</span> (in != null &amp;&amp; in.available() &lt; 0)
<a name="l01415"></a>01415                     {
<a name="l01416"></a>01416                         <span class="keywordflow">throw</span> <span class="keyword">new</span> EOFException();
<a name="l01417"></a>01417                     }
<a name="l01418"></a>01418 
<a name="l01419"></a>01419                 }
<a name="l01420"></a>01420                 <span class="keywordflow">catch</span> (EOFException e)
<a name="l01421"></a>01421                 {
<a name="l01422"></a>01422                     <span class="comment">// Input file was truncated (or error)</span>
<a name="l01423"></a>01423                     <span class="comment">// Reopen file to start over.</span>
<a name="l01424"></a>01424 
<a name="l01425"></a>01425                     System.out.println(e);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427                     <span class="keywordflow">if</span> (usingGui)
<a name="l01428"></a>01428                     {
<a name="l01429"></a>01429                         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#00c184e981bba1a3471b7fa0509e51aa">openFile</a>();
<a name="l01430"></a>01430                     }
<a name="l01431"></a>01431                     <span class="keywordflow">else</span>
<a name="l01432"></a>01432                     {
<a name="l01433"></a>01433                         <span class="comment">// batch mode, hit EOF unexpectedly, so quit</span>
<a name="l01434"></a>01434                         continueRunning = <span class="keyword">false</span>;
<a name="l01435"></a>01435                     }
<a name="l01436"></a>01436                 }
<a name="l01437"></a>01437                 <span class="keywordflow">catch</span> (IOException e)
<a name="l01438"></a>01438                 {
<a name="l01439"></a>01439                     System.out.println(e);
<a name="l01440"></a>01440                 }
<a name="l01441"></a>01441 
<a name="l01442"></a>01442                 <span class="keywordflow">if</span> (repeatPlay)
<a name="l01443"></a>01443                 {
<a name="l01444"></a>01444                     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#c3408607a403ce8ad20f58b4897bc415">sleep</a>();
<a name="l01445"></a>01445                     <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#00c184e981bba1a3471b7fa0509e51aa">openFile</a>();
<a name="l01446"></a>01446                 }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448                 <span class="comment">//System.out.println("read " + count + " bytes");</span>
<a name="l01449"></a>01449 
<a name="l01450"></a>01450                 <span class="comment">// wait for more data to appear</span>
<a name="l01451"></a>01451                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html#c3408607a403ce8ad20f58b4897bc415">sleep</a>();
<a name="l01452"></a>01452             }
<a name="l01453"></a>01453         }
<a name="l01454"></a>01454     }
<a name="l01455"></a>01455 
<a name="l01459"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#f3f8efd7bbd90beeffb8993e25ebb757">01459</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#f3f8efd7bbd90beeffb8993e25ebb757">scaleImage</a>()
<a name="l01460"></a>01460     {
<a name="l01461"></a>01461         <span class="comment">// apply scale &amp; offset to pixels</span>
<a name="l01462"></a>01462         RescaleOp rescaleOp = <span class="keyword">new</span> RescaleOp(pixelScaleFactor, pixelOffsetFactor, null);
<a name="l01463"></a>01463         rescaleOp.filter(origBuffImage, scaledBuffImage);
<a name="l01464"></a>01464     }
<a name="l01465"></a>01465 
<a name="l01469"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d96c46cf786c14bf9a9bfd0afc01f3c8">01469</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d96c46cf786c14bf9a9bfd0afc01f3c8">eraseImage</a>()
<a name="l01470"></a>01470     {
<a name="l01471"></a>01471 
<a name="l01472"></a>01472         <span class="comment">// set all the pixels in original image to zero</span>
<a name="l01473"></a>01473         <span class="keywordtype">float</span> scaleFactor = (float)0.0;
<a name="l01474"></a>01474         <span class="keywordtype">float</span> offsetFactor = (float)0.0;
<a name="l01475"></a>01475         RescaleOp zeroRescaleOp = <span class="keyword">new</span> RescaleOp(scaleFactor, offsetFactor, null);
<a name="l01476"></a>01476         zeroRescaleOp.filter(scaledBuffImage, origBuffImage);
<a name="l01477"></a>01477 
<a name="l01478"></a>01478         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>();
<a name="l01479"></a>01479 
<a name="l01480"></a>01480     }
<a name="l01481"></a>01481 
<a name="l01485"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">01485</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>()
<a name="l01486"></a>01486     {
<a name="l01487"></a>01487         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#f3f8efd7bbd90beeffb8993e25ebb757">scaleImage</a>();
<a name="l01488"></a>01488 
<a name="l01489"></a>01489         <span class="keywordflow">if</span> (usingGui)
<a name="l01490"></a>01490         {
<a name="l01491"></a>01491             imagePanel.repaint();
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493     }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495 
<a name="l01499"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html">01499</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html">OpenFileListener</a> <span class="keyword">implements</span> ActionListener
<a name="l01500"></a>01500     {
<a name="l01501"></a>01501         JFileChooser fc;
<a name="l01502"></a>01502 
<a name="l01508"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html#2adb697b6095d617dfdf7f11a16005e6">01508</a>         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html#2adb697b6095d617dfdf7f11a16005e6">OpenFileListener</a>(JFileChooser fc)
<a name="l01509"></a>01509         {
<a name="l01510"></a>01510             this.fc = fc;
<a name="l01511"></a>01511         }
<a name="l01512"></a>01512 
<a name="l01518"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html#5b3d0d9d13a2a7bb5fc8427a2c92f3bc">01518</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html#5b3d0d9d13a2a7bb5fc8427a2c92f3bc">actionPerformed</a>(ActionEvent e)
<a name="l01519"></a>01519         {
<a name="l01520"></a>01520 
<a name="l01521"></a>01521             <span class="keywordtype">int</span> returnVal = fc.showOpenDialog(<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html">WaterfallDisplay</a>.this);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523             <span class="keywordflow">if</span> (returnVal == JFileChooser.APPROVE_OPTION)
<a name="l01524"></a>01524             {
<a name="l01525"></a>01525 
<a name="l01526"></a>01526                 File file = fc.getSelectedFile();
<a name="l01527"></a>01527                 String fullpath = file.getAbsolutePath();
<a name="l01528"></a>01528                 fileScanner.openNewFile(fullpath);
<a name="l01529"></a>01529                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d6f31936f038ceebafb8a8c6cc5d9fa4">changeDisplayedFilename</a>(file.getName());
<a name="l01530"></a>01530 
<a name="l01531"></a>01531             }
<a name="l01532"></a>01532             <span class="keywordflow">else</span>
<a name="l01533"></a>01533             {
<a name="l01534"></a>01534                 <span class="comment">//System.out.println("Open command cancelled by user.");</span>
<a name="l01535"></a>01535             }
<a name="l01536"></a>01536         }
<a name="l01537"></a>01537     }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539 
<a name="l01543"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html">01543</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html">SaveAsJpegListener</a> <span class="keyword">implements</span> ActionListener
<a name="l01544"></a>01544     {
<a name="l01545"></a>01545 
<a name="l01546"></a>01546         JFileChooser fc;
<a name="l01547"></a>01547 
<a name="l01553"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html#425a8a8b23018a699c8f1dc078efa6a5">01553</a>         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html#425a8a8b23018a699c8f1dc078efa6a5">SaveAsJpegListener</a>(JFileChooser fc)
<a name="l01554"></a>01554         {
<a name="l01555"></a>01555             this.fc = fc;
<a name="l01556"></a>01556         }
<a name="l01557"></a>01557 
<a name="l01563"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html#1d5a0cbb27f8e6ee933e817cda9007f1">01563</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html#1d5a0cbb27f8e6ee933e817cda9007f1">actionPerformed</a>(ActionEvent e)
<a name="l01564"></a>01564         {
<a name="l01565"></a>01565 
<a name="l01566"></a>01566             <span class="keywordtype">int</span> returnVal = fc.showSaveDialog(<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html">WaterfallDisplay</a>.this);
<a name="l01567"></a>01567 
<a name="l01568"></a>01568             <span class="keywordflow">if</span> (returnVal == JFileChooser.APPROVE_OPTION)
<a name="l01569"></a>01569             {
<a name="l01570"></a>01570 
<a name="l01571"></a>01571                 File file = fc.getSelectedFile();
<a name="l01572"></a>01572                 String absoluteFilename = file.getAbsolutePath();
<a name="l01573"></a>01573 
<a name="l01574"></a>01574                 <span class="keywordflow">try</span> 
<a name="l01575"></a>01575                 {
<a name="l01576"></a>01576                     Container content = mainGuiFrame.getContentPane();
<a name="l01577"></a>01577                     Dimension size = content.getSize();
<a name="l01578"></a>01578                     BufferedImage image = 
<a name="l01579"></a>01579                         <span class="keyword">new</span> BufferedImage(size.width, size.height,
<a name="l01580"></a>01580                                 BufferedImage.TYPE_INT_RGB);
<a name="l01581"></a>01581                     Graphics2D g2d = image.createGraphics();
<a name="l01582"></a>01582                     content.paint(g2d);
<a name="l01583"></a>01583 
<a name="l01584"></a>01584                     File jpegFile = <span class="keyword">new</span> File(absoluteFilename);
<a name="l01585"></a>01585                     ImageIO.write(image, <span class="stringliteral">"jpg"</span>, jpegFile);
<a name="l01586"></a>01586                 }
<a name="l01587"></a>01587                 <span class="keywordflow">catch</span> (IOException ioe)
<a name="l01588"></a>01588                 {
<a name="l01589"></a>01589                     System.out.println(ioe);
<a name="l01590"></a>01590                 }
<a name="l01591"></a>01591 
<a name="l01592"></a>01592             }
<a name="l01593"></a>01593             <span class="keywordflow">else</span>
<a name="l01594"></a>01594             {
<a name="l01595"></a>01595                 <span class="comment">//System.out.println("Open command cancelled by user.");</span>
<a name="l01596"></a>01596             }
<a name="l01597"></a>01597         }
<a name="l01598"></a>01598     }
<a name="l01599"></a>01599 
<a name="l01600"></a>01600 
<a name="l01601"></a>01601 
<a name="l01605"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1PrintListener.html">01605</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1PrintListener.html">PrintListener</a> <span class="keyword">implements</span> ActionListener
<a name="l01606"></a>01606     {
<a name="l01607"></a>01607 
<a name="l01613"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1PrintListener.html#344d2dda67d94d99179d46acaf727d57">01613</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1PrintListener.html#344d2dda67d94d99179d46acaf727d57">actionPerformed</a>(ActionEvent e)
<a name="l01614"></a>01614         {
<a name="l01615"></a>01615             PageFormat pageFormat = printJob.defaultPage();
<a name="l01616"></a>01616             pageFormat.setOrientation(PageFormat.LANDSCAPE);
<a name="l01617"></a>01617             printJob.setPrintable(imagePanel, pageFormat);
<a name="l01618"></a>01618 
<a name="l01619"></a>01619             <span class="keywordflow">if</span> (printJob.printDialog())
<a name="l01620"></a>01620             {
<a name="l01621"></a>01621                 <span class="keywordflow">try</span> 
<a name="l01622"></a>01622                 {
<a name="l01623"></a>01623                     printJob.print();  
<a name="l01624"></a>01624                 } <span class="keywordflow">catch</span> (Exception ex)
<a name="l01625"></a>01625                 {
<a name="l01626"></a>01626                     ex.printStackTrace();
<a name="l01627"></a>01627                 }
<a name="l01628"></a>01628             }
<a name="l01629"></a>01629         }
<a name="l01630"></a>01630     }
<a name="l01631"></a>01631 
<a name="l01632"></a>01632 
<a name="l01637"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">01637</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a> <span class="keyword">extends</span> javax.swing.filechooser.FileFilter
<a name="l01638"></a>01638     {
<a name="l01639"></a>01639 
<a name="l01641"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#ba646685cd3111ccfeb2fa20d3664dff">01641</a>         String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#ba646685cd3111ccfeb2fa20d3664dff">fileExtension</a>;
<a name="l01643"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#8c630a8bd094a832de586d786d053b35">01643</a>         String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#8c630a8bd094a832de586d786d053b35">fileDescription</a>;
<a name="l01644"></a>01644 
<a name="l01651"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#11d28dcc2ee14a6e8d498578bca93030">01651</a>         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#11d28dcc2ee14a6e8d498578bca93030">CustomFilenameFilter</a>(String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#ba646685cd3111ccfeb2fa20d3664dff">fileExtension</a>, String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#8c630a8bd094a832de586d786d053b35">fileDescription</a>)
<a name="l01652"></a>01652         {
<a name="l01653"></a>01653             this.fileExtension = fileExtension;
<a name="l01654"></a>01654             this.fileDescription = fileDescription;
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656 
<a name="l01663"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#dbfb9db881caaf40085473296b3a9515">01663</a>         <span class="keyword">public</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#dbfb9db881caaf40085473296b3a9515">getExtension</a>(File f)
<a name="l01664"></a>01664         {
<a name="l01665"></a>01665             String ext = null;
<a name="l01666"></a>01666             String s = f.getName();
<a name="l01667"></a>01667             <span class="keywordtype">int</span> i = s.lastIndexOf(<span class="charliteral">'.'</span>);
<a name="l01668"></a>01668 
<a name="l01669"></a>01669             <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp;  i &lt; s.length() - 1)
<a name="l01670"></a>01670             {
<a name="l01671"></a>01671                 ext = s.substring(i+1).toLowerCase();
<a name="l01672"></a>01672             }
<a name="l01673"></a>01673             <span class="keywordflow">return</span> ext;
<a name="l01674"></a>01674         }
<a name="l01675"></a>01675 
<a name="l01681"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#c7626bd586c051bc1482ea4263609c6a">01681</a>         <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#c7626bd586c051bc1482ea4263609c6a">accept</a>(File f)
<a name="l01682"></a>01682         {
<a name="l01683"></a>01683 
<a name="l01684"></a>01684 
<a name="l01685"></a>01685             <span class="keywordflow">if</span> (f.isDirectory())
<a name="l01686"></a>01686             {
<a name="l01687"></a>01687                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01688"></a>01688             }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690             String extension = <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#dbfb9db881caaf40085473296b3a9515">getExtension</a>(f);
<a name="l01691"></a>01691             <span class="keywordflow">if</span> (extension != null)
<a name="l01692"></a>01692             {
<a name="l01693"></a>01693                 <span class="keywordflow">if</span> (extension.equals(<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#ba646685cd3111ccfeb2fa20d3664dff">fileExtension</a>))
<a name="l01694"></a>01694                 {
<a name="l01695"></a>01695                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01696"></a>01696                 }
<a name="l01697"></a>01697                 <span class="keywordflow">else</span>
<a name="l01698"></a>01698                 {
<a name="l01699"></a>01699                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01700"></a>01700                 }
<a name="l01701"></a>01701             }
<a name="l01702"></a>01702 
<a name="l01703"></a>01703             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01704"></a>01704         }
<a name="l01705"></a>01705 
<a name="l01711"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#c0152abb7dde09e02972b40277ca8815">01711</a>         <span class="keyword">public</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#c0152abb7dde09e02972b40277ca8815">getDescription</a>()
<a name="l01712"></a>01712         {
<a name="l01713"></a>01713             <span class="keywordflow">return</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html#8c630a8bd094a832de586d786d053b35">fileDescription</a>;
<a name="l01714"></a>01714         }
<a name="l01715"></a>01715     }
<a name="l01716"></a>01716 
<a name="l01720"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OffsetSliderListener.html">01720</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OffsetSliderListener.html">OffsetSliderListener</a> <span class="keyword">implements</span> ChangeListener
<a name="l01721"></a>01721     {
<a name="l01727"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OffsetSliderListener.html#f453e163c3172259f58fa0932c9d23ce">01727</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OffsetSliderListener.html#f453e163c3172259f58fa0932c9d23ce">stateChanged</a>(ChangeEvent e)
<a name="l01728"></a>01728         {
<a name="l01729"></a>01729             JSlider source = (JSlider)e.getSource();
<a name="l01730"></a>01730             <span class="keywordflow">if</span> (! source.getValueIsAdjusting())
<a name="l01731"></a>01731             {
<a name="l01732"></a>01732                 <span class="keywordtype">float</span> value = (float)source.getValue();
<a name="l01733"></a>01733                 pixelOffsetFactor = value;
<a name="l01734"></a>01734                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>();
<a name="l01735"></a>01735             }
<a name="l01736"></a>01736         }
<a name="l01737"></a>01737     }
<a name="l01738"></a>01738 
<a name="l01742"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ScaleSliderListener.html">01742</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ScaleSliderListener.html">ScaleSliderListener</a> <span class="keyword">implements</span> ChangeListener
<a name="l01743"></a>01743     {
<a name="l01749"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ScaleSliderListener.html#7b4b40b7fd282f984e0bd603867f0f73">01749</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ScaleSliderListener.html#7b4b40b7fd282f984e0bd603867f0f73">stateChanged</a>(ChangeEvent e)
<a name="l01750"></a>01750         {
<a name="l01751"></a>01751             JSlider source = (JSlider)e.getSource();
<a name="l01752"></a>01752             <span class="keywordflow">if</span> (! source.getValueIsAdjusting())
<a name="l01753"></a>01753             {
<a name="l01754"></a>01754                 <span class="keywordtype">float</span> value = (float)source.getValue() / 100;
<a name="l01755"></a>01755                 pixelScaleFactor = value;
<a name="l01756"></a>01756                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>();
<a name="l01757"></a>01757             }    
<a name="l01758"></a>01758         }
<a name="l01759"></a>01759     }
<a name="l01760"></a>01760 
<a name="l01764"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ResolutionListener.html">01764</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ResolutionListener.html">ResolutionListener</a> <span class="keyword">implements</span> ActionListener
<a name="l01765"></a>01765     {
<a name="l01766"></a>01766 
<a name="l01772"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ResolutionListener.html#086555521d4ade6adbe83ea986b2fb62">01772</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ResolutionListener.html#086555521d4ade6adbe83ea986b2fb62">actionPerformed</a>(ActionEvent e) 
<a name="l01773"></a>01773         {
<a name="l01774"></a>01774             JComboBox cb = (JComboBox)e.getSource();
<a name="l01775"></a>01775             String resolutionValue = (String)cb.getSelectedItem();
<a name="l01776"></a>01776 
<a name="l01777"></a>01777             <span class="keywordflow">if</span> (resolutionValue.equals(<span class="stringliteral">"1 Hz"</span>)) 
<a name="l01778"></a>01778             {
<a name="l01779"></a>01779                 displayResolution = 1;
<a name="l01780"></a>01780             }
<a name="l01781"></a>01781             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resolutionValue.equals(<span class="stringliteral">"2 Hz"</span>)) 
<a name="l01782"></a>01782             {
<a name="l01783"></a>01783                 displayResolution = 2;
<a name="l01784"></a>01784             }
<a name="l01785"></a>01785             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resolutionValue.equals(<span class="stringliteral">"4 Hz"</span>)) 
<a name="l01786"></a>01786             {
<a name="l01787"></a>01787                 displayResolution = 4;
<a name="l01788"></a>01788             }
<a name="l01789"></a>01789             <span class="keywordflow">else</span> 
<a name="l01790"></a>01790             {
<a name="l01791"></a>01791                 System.out.println(<span class="stringliteral">"Error selecting resolution"</span>);
<a name="l01792"></a>01792             }
<a name="l01793"></a>01793 
<a name="l01794"></a>01794             <span class="comment">// reopen data file to display in the new resolution</span>
<a name="l01795"></a>01795             fileScanner.openFile();
<a name="l01796"></a>01796 
<a name="l01797"></a>01797         }
<a name="l01798"></a>01798     }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800 
<a name="l01804"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SubbandOffsetListener.html">01804</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SubbandOffsetListener.html">SubbandOffsetListener</a> <span class="keyword">implements</span> ActionListener
<a name="l01805"></a>01805     {
<a name="l01806"></a>01806 
<a name="l01813"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SubbandOffsetListener.html#468139bc4ecdbc5b7189d2326ac9952f">01813</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SubbandOffsetListener.html#468139bc4ecdbc5b7189d2326ac9952f">actionPerformed</a>(ActionEvent e)
<a name="l01814"></a>01814         {
<a name="l01815"></a>01815             JComboBox cb = (JComboBox)e.getSource();
<a name="l01816"></a>01816             String subbandOffsetString = (String)cb.getSelectedItem();
<a name="l01817"></a>01817 
<a name="l01818"></a>01818             <span class="comment">//System.out.println("selected subbandOffset " + subbandOffsetString);</span>
<a name="l01819"></a>01819 
<a name="l01820"></a>01820             subbandOffset = Integer.parseInt(subbandOffsetString); 
<a name="l01821"></a>01821 
<a name="l01822"></a>01822             compAmps.setSubbandOffset(subbandOffset);
<a name="l01823"></a>01823 
<a name="l01824"></a>01824             <span class="comment">// re-read the file at the new subbandOffset</span>
<a name="l01825"></a>01825             fileScanner.openFile();
<a name="l01826"></a>01826 
<a name="l01827"></a>01827         }
<a name="l01828"></a>01828     }
<a name="l01829"></a>01829 
<a name="l01830"></a>01830 
<a name="l01836"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d6f31936f038ceebafb8a8c6cc5d9fa4">01836</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d6f31936f038ceebafb8a8c6cc5d9fa4">changeDisplayedFilename</a>(String newname)
<a name="l01837"></a>01837     {
<a name="l01838"></a>01838         currentFileText.setText(<span class="stringliteral">""</span> + newname + <span class="stringliteral">""</span>);
<a name="l01839"></a>01839         aveCompAmpsCurrentFileText.setText(newname);
<a name="l01840"></a>01840     }
<a name="l01841"></a>01841 
<a name="l01842"></a>01842 
<a name="l01849"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#f457ff4b078f3345da7a228aa86ec985">01849</a>     <span class="keyword">private</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#f457ff4b078f3345da7a228aa86ec985">getArchiveDir</a>()
<a name="l01850"></a>01850     {
<a name="l01851"></a>01851         <a class="code" href="classopensonata_1_1dataDisplays_1_1EnvReader.html">EnvReader</a> env = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1EnvReader.html">EnvReader</a>();
<a name="l01852"></a>01852         String archiveDir = env.<a class="code" href="classopensonata_1_1dataDisplays_1_1EnvReader.html#868b79b0cef54eb21702eca1033e693c">getEnvVar</a>(<span class="stringliteral">"SSE_ARCHIVE"</span>); 
<a name="l01853"></a>01853         <span class="keywordflow">if</span> (archiveDir == null)
<a name="l01854"></a>01854         {
<a name="l01855"></a>01855             archiveDir = env.<a class="code" href="classopensonata_1_1dataDisplays_1_1EnvReader.html#868b79b0cef54eb21702eca1033e693c">getEnvVar</a>(<span class="stringliteral">"HOME"</span>) + <span class="stringliteral">"/sse_archive"</span>; 
<a name="l01856"></a>01856         }
<a name="l01857"></a>01857         <span class="keywordflow">return</span> archiveDir;
<a name="l01858"></a>01858     }
<a name="l01859"></a>01859 
<a name="l01868"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#91773b060b6eaa2e88bc772df9e429da">01868</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#91773b060b6eaa2e88bc772df9e429da">convertBinNumberToFreq</a>(<span class="keywordtype">int</span> binNumber,
<a name="l01869"></a>01869             <span class="keywordtype">double</span> rfCenterFrequency,
<a name="l01870"></a>01870             <span class="keywordtype">double</span> hzPerSubband)
<a name="l01871"></a>01871     {
<a name="l01872"></a>01872         <span class="comment">// define the nominal 1Hz values</span>
<a name="l01873"></a>01873         <span class="keywordtype">int</span> numberOfBinsPerSubband = MAX_SUBBAND_BINS_PER_1HZ_HALF_FRAME;
<a name="l01874"></a>01874         <span class="keywordflow">if</span> (compAmps.activityId &gt; 0)
<a name="l01875"></a>01875         {
<a name="l01876"></a>01876             numberOfBinsPerSubband = (int) (numberOfBinsPerSubband
<a name="l01877"></a>01877                     * (1.0 - compAmps.overSampling));
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879 
<a name="l01880"></a>01880         <span class="comment">// adjust number of bins if the display mode is currently 2 Hz</span>
<a name="l01881"></a>01881         numberOfBinsPerSubband /= this.displayResolution;
<a name="l01882"></a>01882 
<a name="l01883"></a>01883         <span class="keywordtype">double</span> hzPerBin = hzPerSubband / numberOfBinsPerSubband;
<a name="l01884"></a>01884         <span class="keywordtype">double</span> hzPerMHz = 1e6;
<a name="l01885"></a>01885 
<a name="l01886"></a>01886         <span class="comment">// figure out how far the desired bin is from the </span>
<a name="l01887"></a>01887         <span class="comment">// center.</span>
<a name="l01888"></a>01888 
<a name="l01889"></a>01889         <span class="keywordtype">int</span> centerBinNumber = numberOfBinsPerSubband / 2;
<a name="l01890"></a>01890         <span class="keywordtype">double</span> offsetInHz = (binNumber - centerBinNumber) * hzPerBin;
<a name="l01891"></a>01891         <span class="keywordtype">double</span> freqInMHz = offsetInHz / hzPerMHz + rfCenterFrequency;
<a name="l01892"></a>01892 
<a name="l01893"></a>01893         <span class="keywordflow">return</span> freqInMHz;
<a name="l01894"></a>01894     }
<a name="l01895"></a>01895 
<a name="l01899"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html">01899</a>     <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html">ReadoutBinNumberMouseListener</a> <span class="keyword">implements</span> MouseMotionListener 
<a name="l01900"></a>01900     {
<a name="l01901"></a>01901         <span class="comment">// offset to subtract from the x position due to the left border</span>
<a name="l01902"></a>01902         <span class="comment">// of the container the image is in</span>
<a name="l01903"></a>01903 
<a name="l01904"></a>01904         <span class="keywordtype">int</span> leftBorderOffset;  
<a name="l01905"></a>01905 
<a name="l01912"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html#29aae17b18bc5ce5599baa38e3fa9892">01912</a>         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html#29aae17b18bc5ce5599baa38e3fa9892">ReadoutBinNumberMouseListener</a>(<span class="keywordtype">int</span> leftBorderOffset) 
<a name="l01913"></a>01913         {
<a name="l01914"></a>01914             this.leftBorderOffset = leftBorderOffset;
<a name="l01915"></a>01915         }
<a name="l01916"></a>01916 
<a name="l01923"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html#3377c4f47999d72227f908c1c9925cae">01923</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html#3377c4f47999d72227f908c1c9925cae">mouseDragged</a>(MouseEvent event)
<a name="l01924"></a>01924         {
<a name="l01925"></a>01925         }
<a name="l01926"></a>01926 
<a name="l01933"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html#89e5b8fec1839b8ae4bcaaef977ddebb">01933</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html#89e5b8fec1839b8ae4bcaaef977ddebb">mouseMoved</a>(MouseEvent event) 
<a name="l01934"></a>01934         {
<a name="l01935"></a>01935 
<a name="l01936"></a>01936             <span class="keywordtype">int</span> x = <span class="keyword">event</span>.getX() - leftBorderOffset;
<a name="l01937"></a>01937             <span class="keywordtype">int</span> bin = (width/2) - ((width/2) - x)*displayResolution ; 
<a name="l01938"></a>01938 
<a name="l01939"></a>01939             <span class="comment">// don't let bin go negative or positive</span>
<a name="l01940"></a>01940             <span class="keywordflow">if</span> (bin &lt; 0 || bin &gt; width)
<a name="l01941"></a>01941             {
<a name="l01942"></a>01942                 binNumberReadoutValueLabel.setText(<span class="stringliteral">"?"</span>);
<a name="l01943"></a>01943                 binFreqReadoutValueLabel.setText(<span class="stringliteral">"?"</span>);
<a name="l01944"></a>01944             }
<a name="l01945"></a>01945             <span class="keywordflow">else</span>
<a name="l01946"></a>01946             {
<a name="l01947"></a>01947 
<a name="l01948"></a>01948                 DecimalFormat binFormatter = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000"</span>);
<a name="l01949"></a>01949                 binNumberReadoutValueLabel.setText(binFormatter.format(bin));
<a name="l01950"></a>01950 
<a name="l01951"></a>01951                 <span class="keywordtype">double</span> freq = <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#91773b060b6eaa2e88bc772df9e429da">convertBinNumberToFreq</a>(bin, 
<a name="l01952"></a>01952                         compAmps.rfCenterFrequency,
<a name="l01953"></a>01953                         compAmps.hzPerSubband);
<a name="l01954"></a>01954 
<a name="l01955"></a>01955                 DecimalFormat freqFormatter = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000.000000 MHz"</span>);
<a name="l01956"></a>01956                 binFreqReadoutValueLabel.setText(freqFormatter.format(freq));
<a name="l01957"></a>01957             }
<a name="l01958"></a>01958         }
<a name="l01959"></a>01959     }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961 
<a name="l01971"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#330207b0057490b521e24b85bf9f50a7">01971</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#330207b0057490b521e24b85bf9f50a7">readoutData</a>(<a class="code" href="classopensonata_1_1dataDisplays_1_1ReadoutPlot.html">ReadoutPlot</a> source, 
<a name="l01972"></a>01972             <span class="keywordtype">double</span> xPlotValue,
<a name="l01973"></a>01973             <span class="keywordtype">double</span> yPlotValue)
<a name="l01974"></a>01974     {
<a name="l01975"></a>01975 
<a name="l01976"></a>01976         <span class="comment">// don't let bin number or power go negative</span>
<a name="l01977"></a>01977         <span class="keywordtype">int</span> binNumber = (int) (xPlotValue + 0.5);
<a name="l01978"></a>01978         <span class="keywordflow">if</span> (binNumber &lt; 0) binNumber = 0;
<a name="l01979"></a>01979 
<a name="l01980"></a>01980         <span class="keywordtype">float</span> power = (float) yPlotValue;
<a name="l01981"></a>01981         <span class="keywordflow">if</span> (power &lt; 0) power = 0;
<a name="l01982"></a>01982 
<a name="l01983"></a>01983         <span class="keywordtype">double</span> freq = <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#91773b060b6eaa2e88bc772df9e429da">convertBinNumberToFreq</a>(binNumber, compAmps.rfCenterFrequency,
<a name="l01984"></a>01984                 compAmps.hzPerSubband);
<a name="l01985"></a>01985 
<a name="l01986"></a>01986         DecimalFormat freqFormatter = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000.000000 MHz"</span>);
<a name="l01987"></a>01987         DecimalFormat binFormatter = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"0000"</span>);
<a name="l01988"></a>01988         DecimalFormat powerFormatter = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"00000.000  "</span>);
<a name="l01989"></a>01989 
<a name="l01990"></a>01990         aveCompAmpsBinFreqReadoutValueLabel.setText(freqFormatter.format(freq));
<a name="l01991"></a>01991         aveCompAmpsBinNumberReadoutValueLabel.setText(binFormatter.format(binNumber));
<a name="l01992"></a>01992         aveCompAmpsPowerReadoutValueLabel.setText(powerFormatter.format(power));
<a name="l01993"></a>01993 
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995 
<a name="l01999"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d1ee481e2115800216b0968d43b61a61">01999</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d1ee481e2115800216b0968d43b61a61">createImageAdjustmentControlPanel</a>()
<a name="l02000"></a>02000     {
<a name="l02001"></a>02001         <span class="keywordtype">int</span> frameWidth = 425;
<a name="l02002"></a>02002         <span class="keywordtype">int</span> frameHeight = 125;
<a name="l02003"></a>02003 
<a name="l02004"></a>02004         imageAdjustmentFrame = <span class="keyword">new</span> JFrame(<span class="stringliteral">"SonATA Complex Amplitudes - Image Adjustment"</span>);
<a name="l02005"></a>02005         imageAdjustmentFrame.setSize(frameWidth, frameHeight);
<a name="l02006"></a>02006 
<a name="l02007"></a>02007         JPanel controlPanel = <span class="keyword">new</span> JPanel();
<a name="l02008"></a>02008         controlPanel.setBorder(BorderFactory.createLineBorder(Color.blue));
<a name="l02009"></a>02009         controlPanel.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02010"></a>02010 
<a name="l02011"></a>02011         JPanel controlPanelPart1 = <span class="keyword">new</span> JPanel();
<a name="l02012"></a>02012         controlPanelPart1.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02013"></a>02013         controlPanel.add(BorderLayout.NORTH, controlPanelPart1);
<a name="l02014"></a>02014 
<a name="l02015"></a>02015         <span class="comment">// constrast control (pixel multiplier)</span>
<a name="l02016"></a>02016         JSlider multiplySlider = <span class="keyword">new</span> JSlider(JSlider.HORIZONTAL, 0, 1000, 400);
<a name="l02017"></a>02017         multiplySlider.setBorder(<span class="keyword">new</span> TitledBorder(<span class="stringliteral">"Contrast"</span>));
<a name="l02018"></a>02018         multiplySlider.setMajorTickSpacing(200);
<a name="l02019"></a>02019         multiplySlider.setPaintTicks(<span class="keyword">true</span>);
<a name="l02020"></a>02020         multiplySlider.setPaintLabels(<span class="keyword">true</span>);
<a name="l02021"></a>02021         multiplySlider.addChangeListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ScaleSliderListener.html">ScaleSliderListener</a>());
<a name="l02022"></a>02022         controlPanelPart1.add(BorderLayout.WEST, multiplySlider);
<a name="l02023"></a>02023 
<a name="l02024"></a>02024         <span class="comment">// offset control</span>
<a name="l02025"></a>02025         JSlider offsetSlider = <span class="keyword">new</span> JSlider(JSlider.HORIZONTAL, -100, 100, 0);
<a name="l02026"></a>02026         offsetSlider.setBorder(<span class="keyword">new</span> TitledBorder(<span class="stringliteral">"Brightness"</span>));
<a name="l02027"></a>02027         offsetSlider.setMajorTickSpacing(50);
<a name="l02028"></a>02028         offsetSlider.setPaintTicks(<span class="keyword">true</span>);
<a name="l02029"></a>02029         offsetSlider.setPaintLabels(<span class="keyword">true</span>);
<a name="l02030"></a>02030         offsetSlider.addChangeListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OffsetSliderListener.html">OffsetSliderListener</a>());
<a name="l02031"></a>02031         controlPanelPart1.add(BorderLayout.EAST, offsetSlider);
<a name="l02032"></a>02032 
<a name="l02033"></a>02033         Container cp = imageAdjustmentFrame.getContentPane();
<a name="l02034"></a>02034         cp.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02035"></a>02035         cp.add(BorderLayout.NORTH, controlPanel);
<a name="l02036"></a>02036 
<a name="l02037"></a>02037 
<a name="l02038"></a>02038     }
<a name="l02039"></a>02039 
<a name="l02043"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#bd6b9dda09be6ba3d80122bc8863f796">02043</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#bd6b9dda09be6ba3d80122bc8863f796">createCompAmpTimeAvgPlot</a>()
<a name="l02044"></a>02044     {
<a name="l02045"></a>02045         <span class="keywordtype">int</span> plotFrameWidth = 660;
<a name="l02046"></a>02046         <span class="keywordtype">int</span> plotFrameHeight = 400;
<a name="l02047"></a>02047 
<a name="l02048"></a>02048         plotFrame = <span class="keyword">new</span> JFrame(<span class="stringliteral">"SonATA Complex Amplitudes - Time Average"</span>);
<a name="l02049"></a>02049         plotFrame.setSize(plotFrameWidth, plotFrameHeight);
<a name="l02050"></a>02050 
<a name="l02051"></a>02051         readoutPlot = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1ReadoutPlot.html">ReadoutPlot</a>();
<a name="l02052"></a>02052         readoutPlot.<a class="code" href="classopensonata_1_1dataDisplays_1_1ReadoutPlot.html#d670e5bc4d2c16b3c39543aa78f47a9d">addReadoutListener</a>(<span class="keyword">this</span>);
<a name="l02053"></a>02053         readoutPlot.setTitle(<span class="stringliteral">"SonATA Complex Amplitudes - Time Average"</span>);
<a name="l02054"></a>02054         readoutPlot.setXLabel(<span class="stringliteral">"Bin Number"</span>);
<a name="l02055"></a>02055         readoutPlot.setYLabel(<span class="stringliteral">"Power"</span>);
<a name="l02056"></a>02056         readoutPlot.setCursor(<span class="keyword">new</span> Cursor(Cursor.CROSSHAIR_CURSOR));
<a name="l02057"></a>02057 
<a name="l02058"></a>02058         <span class="comment">//plotFrame.setVisible(true);</span>
<a name="l02059"></a>02059 
<a name="l02060"></a>02060         JPanel controlPanel = <span class="keyword">new</span> JPanel();
<a name="l02061"></a>02061         controlPanel.setBorder(BorderFactory.createLineBorder(Color.blue));
<a name="l02062"></a>02062         controlPanel.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02063"></a>02063 
<a name="l02064"></a>02064         JPanel controlPanelPart1 = <span class="keyword">new</span> JPanel();
<a name="l02065"></a>02065         controlPanelPart1.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02066"></a>02066         controlPanel.add(BorderLayout.NORTH, controlPanelPart1);
<a name="l02067"></a>02067 
<a name="l02068"></a>02068         JPanel controlLine1Panel = <span class="keyword">new</span> JPanel();
<a name="l02069"></a>02069         controlPanelPart1.add(BorderLayout.NORTH, controlLine1Panel);
<a name="l02070"></a>02070 
<a name="l02071"></a>02071         JPanel controlLine2Panel = <span class="keyword">new</span> JPanel();
<a name="l02072"></a>02072         controlPanelPart1.add(BorderLayout.SOUTH, controlLine2Panel);
<a name="l02073"></a>02073 
<a name="l02074"></a>02074         <span class="comment">// subband number</span>
<a name="l02075"></a>02075         JLabel aveCompAmpsSubbandNumberTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Subband: "</span>);
<a name="l02076"></a>02076         aveCompAmpsSubbandNumberValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02077"></a>02077         controlLine1Panel.add(aveCompAmpsSubbandNumberTitleLabel);
<a name="l02078"></a>02078         controlLine1Panel.add(aveCompAmpsSubbandNumberValueLabel);
<a name="l02079"></a>02079 
<a name="l02080"></a>02080         <span class="comment">// cursor readout values</span>
<a name="l02081"></a>02081         <span class="comment">// bin freq</span>
<a name="l02082"></a>02082         JLabel aveCompAmpsBinFreqReadoutTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Cursor Freq: "</span>);
<a name="l02083"></a>02083         aveCompAmpsBinFreqReadoutValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02084"></a>02084         controlLine1Panel.add(aveCompAmpsBinFreqReadoutTitleLabel);
<a name="l02085"></a>02085         controlLine1Panel.add(aveCompAmpsBinFreqReadoutValueLabel);
<a name="l02086"></a>02086 
<a name="l02087"></a>02087         <span class="comment">// cursor readout - bin number</span>
<a name="l02088"></a>02088         JLabel aveCompAmpsBinNumberReadoutTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Bin: "</span>);
<a name="l02089"></a>02089         aveCompAmpsBinNumberReadoutValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02090"></a>02090         controlLine1Panel.add(aveCompAmpsBinNumberReadoutTitleLabel);
<a name="l02091"></a>02091         controlLine1Panel.add(aveCompAmpsBinNumberReadoutValueLabel);
<a name="l02092"></a>02092 
<a name="l02093"></a>02093         <span class="comment">// cursor readout - power</span>
<a name="l02094"></a>02094         JLabel aveCompAmpsPowerReadoutTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Power: "</span>);
<a name="l02095"></a>02095         aveCompAmpsPowerReadoutValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02096"></a>02096         controlLine1Panel.add(aveCompAmpsPowerReadoutTitleLabel);
<a name="l02097"></a>02097         controlLine1Panel.add(aveCompAmpsPowerReadoutValueLabel);
<a name="l02098"></a>02098 
<a name="l02099"></a>02099         <span class="comment">// bandwidth</span>
<a name="l02100"></a>02100         JLabel aveCompAmpsBandwidthTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Bandwidth: "</span>);
<a name="l02101"></a>02101         aveCompAmpsBandwidthValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02102"></a>02102         controlLine1Panel.add(aveCompAmpsBandwidthTitleLabel);
<a name="l02103"></a>02103         controlLine1Panel.add(aveCompAmpsBandwidthValueLabel);
<a name="l02104"></a>02104 
<a name="l02105"></a>02105 
<a name="l02106"></a>02106         <span class="comment">// current filename</span>
<a name="l02107"></a>02107         JLabel aveCompAmpsCurrentFileLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"File: "</span>);
<a name="l02108"></a>02108         aveCompAmpsCurrentFileText = <span class="keyword">new</span> JLabel(<span class="stringliteral">"None"</span>);
<a name="l02109"></a>02109         controlLine2Panel.add(aveCompAmpsCurrentFileLabel);
<a name="l02110"></a>02110         controlLine2Panel.add(aveCompAmpsCurrentFileText);
<a name="l02111"></a>02111         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d6f31936f038ceebafb8a8c6cc5d9fa4">changeDisplayedFilename</a>(<span class="keyword">new</span> File(inFilename).getName());  <span class="comment">// display last part only</span>
<a name="l02112"></a>02112 
<a name="l02113"></a>02113         Container cp = plotFrame.getContentPane();
<a name="l02114"></a>02114         cp.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02115"></a>02115         cp.add(BorderLayout.NORTH, controlPanel);
<a name="l02116"></a>02116         cp.add(BorderLayout.CENTER, readoutPlot);
<a name="l02117"></a>02117 
<a name="l02118"></a>02118     }
<a name="l02119"></a>02119 
<a name="l02123"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#4d44788a67eb6c1af5739283a71bb968">02123</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#4d44788a67eb6c1af5739283a71bb968">setUpGui</a>()
<a name="l02124"></a>02124     {
<a name="l02125"></a>02125 
<a name="l02126"></a>02126         <span class="comment">// ------- Menu ---------------------</span>
<a name="l02127"></a>02127 
<a name="l02128"></a>02128         JMenuBar menuBar = <span class="keyword">new</span> JMenuBar();
<a name="l02129"></a>02129         mainGuiFrame.setJMenuBar(menuBar);
<a name="l02130"></a>02130 
<a name="l02131"></a>02131         JMenu fileMenu = <span class="keyword">new</span> JMenu(<span class="stringliteral">"File"</span>);
<a name="l02132"></a>02132         menuBar.add(fileMenu);
<a name="l02133"></a>02133 
<a name="l02134"></a>02134 
<a name="l02135"></a>02135         JFileChooser openFileChooser = <span class="keyword">new</span> JFileChooser();
<a name="l02136"></a>02136 
<a name="l02137"></a>02137         <span class="comment">// get the location of the confirmation data in the</span>
<a name="l02138"></a>02138         <span class="comment">// archive data directory</span>
<a name="l02139"></a>02139         String confirmDataDir = <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#f457ff4b078f3345da7a228aa86ec985">getArchiveDir</a>() + <span class="stringliteral">"/confirmdata"</span>;
<a name="l02140"></a>02140         openFileChooser.setCurrentDirectory(<span class="keyword">new</span> File(confirmDataDir));
<a name="l02141"></a>02141 
<a name="l02142"></a>02142         <span class="keywordflow">if</span> (readGrayscalePixels)
<a name="l02143"></a>02143         {
<a name="l02144"></a>02144             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a> grayFilenameFilter = 
<a name="l02145"></a>02145                 <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a>(<span class="stringliteral">"gray"</span>, <span class="stringliteral">"*.gray (gray scale pixels)"</span>);
<a name="l02146"></a>02146             openFileChooser.setFileFilter(grayFilenameFilter);
<a name="l02147"></a>02147         }
<a name="l02148"></a>02148         <span class="keywordflow">else</span>
<a name="l02149"></a>02149         {
<a name="l02150"></a>02150 
<a name="l02151"></a>02151             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a> archiveCompampFilenameFilter = 
<a name="l02152"></a>02152                 <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a>(<span class="stringliteral">"archive-compamp"</span>, 
<a name="l02153"></a>02153                         <span class="stringliteral">"*.archive-compamp (archive complex amplitudes)"</span>);
<a name="l02154"></a>02154             openFileChooser.setFileFilter(archiveCompampFilenameFilter);
<a name="l02155"></a>02155 
<a name="l02156"></a>02156             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a> compampFilenameFilter = 
<a name="l02157"></a>02157                 <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a>(<span class="stringliteral">"compamp"</span>, <span class="stringliteral">"*.compamp (complex amplitudes)"</span>);
<a name="l02158"></a>02158             openFileChooser.setFileFilter(compampFilenameFilter);
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 
<a name="l02161"></a>02161         }
<a name="l02162"></a>02162 
<a name="l02163"></a>02163         JMenuItem openFileMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Open File ..."</span>);
<a name="l02164"></a>02164         fileMenu.add(openFileMenuItem);
<a name="l02165"></a>02165         openFileMenuItem.addActionListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1OpenFileListener.html">OpenFileListener</a>(openFileChooser));
<a name="l02166"></a>02166 
<a name="l02170"></a>02170         <span class="keyword">class </span>RereadListener <span class="keyword">implements</span> ActionListener
<a name="l02171"></a>02171         {
<a name="l02177"></a>02177             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e)
<a name="l02178"></a>02178             {
<a name="l02179"></a>02179                 fileScanner.openFile();
<a name="l02180"></a>02180             }
<a name="l02181"></a>02181         }
<a name="l02182"></a>02182         JMenuItem rereadFileMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Reread File"</span>);
<a name="l02183"></a>02183         fileMenu.add(rereadFileMenuItem);
<a name="l02184"></a>02184         rereadFileMenuItem.addActionListener(<span class="keyword">new</span> RereadListener());
<a name="l02185"></a>02185 
<a name="l02186"></a>02186 
<a name="l02187"></a>02187         JMenuItem printFileMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Print ..."</span>);
<a name="l02188"></a>02188         fileMenu.add(printFileMenuItem);
<a name="l02189"></a>02189         printFileMenuItem.addActionListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1PrintListener.html">PrintListener</a>());
<a name="l02190"></a>02190         printJob = PrinterJob.getPrinterJob();
<a name="l02191"></a>02191 
<a name="l02192"></a>02192 
<a name="l02193"></a>02193         JMenuItem saveAsJpegFileMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Save As JPeg ..."</span>);
<a name="l02194"></a>02194         JFileChooser jpegFileChooser = <span class="keyword">new</span> JFileChooser();
<a name="l02195"></a>02195         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a> jpegFilenameFilter = 
<a name="l02196"></a>02196             <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1CustomFilenameFilter.html">CustomFilenameFilter</a>(<span class="stringliteral">"jpeg"</span>, <span class="stringliteral">"*.jpeg (jpeg images)"</span>);
<a name="l02197"></a>02197         jpegFileChooser.setFileFilter(jpegFilenameFilter);
<a name="l02198"></a>02198         jpegFileChooser.setDialogTitle(<span class="stringliteral">"Save Display as a JPEG image..."</span>);
<a name="l02199"></a>02199         jpegFileChooser.setDialogType(JFileChooser.SAVE_DIALOG);
<a name="l02200"></a>02200         saveAsJpegFileMenuItem.addActionListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SaveAsJpegListener.html">SaveAsJpegListener</a>(jpegFileChooser));
<a name="l02201"></a>02201         fileMenu.add(saveAsJpegFileMenuItem);
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 
<a name="l02207"></a>02207         <span class="keyword">class </span>ExitListener <span class="keyword">implements</span> ActionListener
<a name="l02208"></a>02208         {
<a name="l02215"></a>02215             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e)
<a name="l02216"></a>02216             {
<a name="l02217"></a>02217                 System.exit(0);
<a name="l02218"></a>02218             }
<a name="l02219"></a>02219         }
<a name="l02220"></a>02220 
<a name="l02221"></a>02221         JMenuItem exitMenuItem = <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Exit"</span>);
<a name="l02222"></a>02222         exitMenuItem.addActionListener(<span class="keyword">new</span> ExitListener());
<a name="l02223"></a>02223         fileMenu.addSeparator();
<a name="l02224"></a>02224         fileMenu.add(exitMenuItem);
<a name="l02225"></a>02225 
<a name="l02226"></a>02226 
<a name="l02227"></a>02227         <span class="comment">// ------- Control Panel ---------------------</span>
<a name="l02228"></a>02228 
<a name="l02229"></a>02229         JPanel controlPanel = <span class="keyword">new</span> JPanel();
<a name="l02230"></a>02230         controlPanel.setBorder(BorderFactory.createLineBorder(Color.blue));
<a name="l02231"></a>02231         controlPanel.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02232"></a>02232 
<a name="l02233"></a>02233         JPanel controlPanelPart1 = <span class="keyword">new</span> JPanel();
<a name="l02234"></a>02234         JPanel controlPanelPart2 = <span class="keyword">new</span> JPanel();
<a name="l02235"></a>02235         controlPanelPart1.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02236"></a>02236         controlPanelPart2.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02237"></a>02237 
<a name="l02238"></a>02238         controlPanel.add(BorderLayout.NORTH, controlPanelPart1);
<a name="l02239"></a>02239         controlPanel.add(BorderLayout.CENTER, controlPanelPart2);
<a name="l02240"></a>02240 
<a name="l02241"></a>02241         JPanel controlLine1Panel = <span class="keyword">new</span> JPanel();
<a name="l02242"></a>02242         JPanel controlLine2Panel = <span class="keyword">new</span> JPanel();
<a name="l02243"></a>02243         controlPanelPart1.add(BorderLayout.NORTH, controlLine1Panel);
<a name="l02244"></a>02244         controlPanelPart1.add(BorderLayout.CENTER, controlLine2Panel);
<a name="l02245"></a>02245 
<a name="l02246"></a>02246         JPanel controlLine3Panel = <span class="keyword">new</span> JPanel();
<a name="l02247"></a>02247         controlPanelPart2.add(BorderLayout.NORTH, controlLine3Panel);
<a name="l02248"></a>02248 
<a name="l02249"></a>02249 
<a name="l02250"></a>02250         <span class="comment">// -- control line 1 ------</span>
<a name="l02251"></a>02251         JLabel resLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Res:"</span>);
<a name="l02252"></a>02252         controlLine1Panel.add(resLabel);
<a name="l02253"></a>02253 
<a name="l02254"></a>02254         <span class="comment">// use a combo box to select the display resolution</span>
<a name="l02255"></a>02255         String[] resolutionStrings = { <span class="stringliteral">"1 Hz"</span>, <span class="stringliteral">"2 Hz"</span>, <span class="stringliteral">"4 Hz"</span>};
<a name="l02256"></a>02256         JComboBox resolutionComboBox = <span class="keyword">new</span> JComboBox(resolutionStrings);
<a name="l02257"></a>02257         resolutionComboBox.setSelectedIndex((<span class="keywordtype">int</span>)(this.displayResolution/2));
<a name="l02258"></a>02258         resolutionComboBox.addActionListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ResolutionListener.html">ResolutionListener</a>());
<a name="l02259"></a>02259         controlLine1Panel.add(resolutionComboBox);
<a name="l02260"></a>02260 
<a name="l02261"></a>02261 
<a name="l02262"></a>02262         <span class="comment">// use a combo box to select the subbandOffset (subband selection)</span>
<a name="l02263"></a>02263         JLabel subbandOffsetLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Subband Offset:"</span>);
<a name="l02264"></a>02264         controlLine1Panel.add(subbandOffsetLabel);
<a name="l02265"></a>02265 
<a name="l02266"></a>02266         String[] subbandOffsetStrings = { <span class="stringliteral">"0"</span>, <span class="stringliteral">"1"</span>, <span class="stringliteral">"2"</span>, <span class="stringliteral">"3"</span>, <span class="stringliteral">"4"</span>, <span class="stringliteral">"5"</span>, <span class="stringliteral">"6"</span>,
<a name="l02267"></a>02267             <span class="stringliteral">"7"</span>, <span class="stringliteral">"8"</span>, <span class="stringliteral">"9"</span>, <span class="stringliteral">"10"</span>, <span class="stringliteral">"11"</span>, <span class="stringliteral">"12"</span>, 
<a name="l02268"></a>02268             <span class="stringliteral">"13"</span>, <span class="stringliteral">"14"</span>, <span class="stringliteral">"15"</span>};
<a name="l02269"></a>02269         JComboBox subbandOffsetComboBox = <span class="keyword">new</span> JComboBox(subbandOffsetStrings);
<a name="l02270"></a>02270         subbandOffsetComboBox.setSelectedIndex(subbandOffset);
<a name="l02271"></a>02271         subbandOffsetComboBox.addActionListener(<span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1SubbandOffsetListener.html">SubbandOffsetListener</a>());
<a name="l02272"></a>02272         controlLine1Panel.add(subbandOffsetComboBox);
<a name="l02273"></a>02273 
<a name="l02274"></a>02274 
<a name="l02275"></a>02275         <span class="comment">// current filename</span>
<a name="l02276"></a>02276         JLabel currentFileLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"File:"</span>);
<a name="l02277"></a>02277         currentFileText = <span class="keyword">new</span> JLabel(<span class="stringliteral">"None"</span>);
<a name="l02278"></a>02278         controlLine1Panel.add(currentFileLabel);
<a name="l02279"></a>02279         controlLine1Panel.add(currentFileText);
<a name="l02280"></a>02280         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d6f31936f038ceebafb8a8c6cc5d9fa4">changeDisplayedFilename</a>(<span class="keyword">new</span> File(inFilename).getName());  <span class="comment">// display last part only</span>
<a name="l02281"></a>02281 
<a name="l02282"></a>02282 
<a name="l02283"></a>02283         <span class="comment">// -- control line 2 ------</span>
<a name="l02284"></a>02284 
<a name="l02285"></a>02285         <span class="comment">// Pol</span>
<a name="l02286"></a>02286         JLabel polTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Pol:"</span>);
<a name="l02287"></a>02287         polValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02288"></a>02288         controlLine2Panel.add(polTitleLabel);
<a name="l02289"></a>02289         controlLine2Panel.add(polValueLabel);
<a name="l02290"></a>02290 
<a name="l02291"></a>02291 
<a name="l02292"></a>02292         <span class="comment">// RF center freq</span>
<a name="l02293"></a>02293         JLabel rfCenterFreqTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Center Freq:"</span>);
<a name="l02294"></a>02294         rfCenterFreqValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02295"></a>02295         controlLine2Panel.add(rfCenterFreqTitleLabel);
<a name="l02296"></a>02296         controlLine2Panel.add(rfCenterFreqValueLabel);
<a name="l02297"></a>02297 
<a name="l02298"></a>02298         <span class="comment">// subband number</span>
<a name="l02299"></a>02299         JLabel subbandNumberTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Subband:"</span>);
<a name="l02300"></a>02300         subbandNumberValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02301"></a>02301         controlLine2Panel.add(subbandNumberTitleLabel);
<a name="l02302"></a>02302         controlLine2Panel.add(subbandNumberValueLabel);
<a name="l02303"></a>02303 
<a name="l02304"></a>02304         <span class="comment">// half frame number</span>
<a name="l02305"></a>02305         JLabel halfFrameNumberTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Half Frame:"</span>);
<a name="l02306"></a>02306         halfFrameNumberValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02307"></a>02307         controlLine2Panel.add(halfFrameNumberTitleLabel);
<a name="l02308"></a>02308         controlLine2Panel.add(halfFrameNumberValueLabel);
<a name="l02309"></a>02309 
<a name="l02310"></a>02310         <span class="comment">// cursor readout values</span>
<a name="l02311"></a>02311         <span class="comment">// bin freq</span>
<a name="l02312"></a>02312         JLabel binFreqReadoutTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Cursor Freq:"</span>);
<a name="l02313"></a>02313         binFreqReadoutValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02314"></a>02314         controlLine2Panel.add(binFreqReadoutTitleLabel);
<a name="l02315"></a>02315         controlLine2Panel.add(binFreqReadoutValueLabel);
<a name="l02316"></a>02316 
<a name="l02317"></a>02317         <span class="comment">// bandwidth</span>
<a name="l02318"></a>02318         JLabel bandwidthTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"BW:"</span>);
<a name="l02319"></a>02319         bandwidthValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02320"></a>02320         controlLine1Panel.add(bandwidthTitleLabel);
<a name="l02321"></a>02321         controlLine1Panel.add(bandwidthValueLabel);
<a name="l02322"></a>02322 
<a name="l02323"></a>02323         <span class="comment">// Activity Id</span>
<a name="l02324"></a>02324         JLabel activityIdTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Act:"</span>);
<a name="l02325"></a>02325         activityIdValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02326"></a>02326         controlLine1Panel.add(activityIdTitleLabel);
<a name="l02327"></a>02327         controlLine1Panel.add(activityIdValueLabel);
<a name="l02328"></a>02328 
<a name="l02329"></a>02329         <span class="comment">// cursor readout - bin number</span>
<a name="l02330"></a>02330         JLabel binNumberReadoutTitleLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"Bin:"</span>);
<a name="l02331"></a>02331         binNumberReadoutValueLabel = <span class="keyword">new</span> JLabel(<span class="stringliteral">"?"</span>);
<a name="l02332"></a>02332         controlLine1Panel.add(binNumberReadoutTitleLabel);
<a name="l02333"></a>02333         controlLine1Panel.add(binNumberReadoutValueLabel);
<a name="l02334"></a>02334 
<a name="l02335"></a>02335         <span class="comment">// Image panel to display the waterfall plot</span>
<a name="l02336"></a>02336         imagePanel = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html">ImagePanel</a>();
<a name="l02337"></a>02337         imagePanel.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ImagePanel.html#f9a75cb170deea51704826b00bc8540e">setImage</a>(scaledBuffImage);
<a name="l02338"></a>02338         imagePanel.setPreferredSize(<span class="keyword">new</span> Dimension(width, height));
<a name="l02339"></a>02339 
<a name="l02340"></a>02340         <span class="keywordtype">int</span> leftBorderWidth = 0;
<a name="l02341"></a>02341         imagePanel.addMouseMotionListener(
<a name="l02342"></a>02342                 <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1ReadoutBinNumberMouseListener.html">ReadoutBinNumberMouseListener</a>(leftBorderWidth));
<a name="l02343"></a>02343 
<a name="l02344"></a>02344         <span class="comment">// Scroll panel that contains the image panel</span>
<a name="l02345"></a>02345         JScrollPane scrollPane = <span class="keyword">new</span> JScrollPane(imagePanel);
<a name="l02346"></a>02346 
<a name="l02347"></a>02347 
<a name="l02348"></a>02348         JMenu viewMenu = <span class="keyword">new</span> JMenu(<span class="stringliteral">"View"</span>);
<a name="l02349"></a>02349         menuBar.add(viewMenu);
<a name="l02350"></a>02350 
<a name="l02354"></a>02354         <span class="keyword">class </span>ClearDisplayListener <span class="keyword">implements</span> ActionListener
<a name="l02355"></a>02355         {
<a name="l02362"></a>02362             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e)
<a name="l02363"></a>02363             {
<a name="l02364"></a>02364                 <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d96c46cf786c14bf9a9bfd0afc01f3c8">eraseImage</a>();  
<a name="l02365"></a>02365             }
<a name="l02366"></a>02366         }
<a name="l02367"></a>02367         JMenuItem clearDisplayMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Clear Display"</span>);
<a name="l02368"></a>02368         viewMenu.add(clearDisplayMenuItem);
<a name="l02369"></a>02369         clearDisplayMenuItem.addActionListener(<span class="keyword">new</span> ClearDisplayListener());
<a name="l02370"></a>02370 
<a name="l02371"></a>02371 
<a name="l02372"></a>02372         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#d1ee481e2115800216b0968d43b61a61">createImageAdjustmentControlPanel</a>();
<a name="l02373"></a>02373 
<a name="l02377"></a>02377         <span class="keyword">class </span>ImageAdjustmentControlPanelListener <span class="keyword">implements</span> ActionListener
<a name="l02378"></a>02378         {
<a name="l02384"></a>02384             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e)
<a name="l02385"></a>02385             {
<a name="l02386"></a>02386                 imageAdjustmentFrame.setVisible(<span class="keyword">true</span>);
<a name="l02387"></a>02387             }
<a name="l02388"></a>02388         }
<a name="l02389"></a>02389 
<a name="l02390"></a>02390         JMenuItem imageAdjustmentControlPanelMenuItem =  
<a name="l02391"></a>02391             <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Adjust Brightness/Contrast..."</span>);
<a name="l02392"></a>02392         viewMenu.add(imageAdjustmentControlPanelMenuItem);
<a name="l02393"></a>02393         imageAdjustmentControlPanelMenuItem.addActionListener(<span class="keyword">new</span> 
<a name="l02394"></a>02394                 ImageAdjustmentControlPanelListener());
<a name="l02395"></a>02395 
<a name="l02396"></a>02396 
<a name="l02397"></a>02397         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#bd6b9dda09be6ba3d80122bc8863f796">createCompAmpTimeAvgPlot</a>();
<a name="l02398"></a>02398 
<a name="l02402"></a>02402         <span class="keyword">class </span>AveCompAmpDisplayListener <span class="keyword">implements</span> ActionListener
<a name="l02403"></a>02403         {
<a name="l02409"></a>02409             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e)
<a name="l02410"></a>02410             {
<a name="l02411"></a>02411                 plotFrame.setVisible(<span class="keyword">true</span>);
<a name="l02412"></a>02412             }
<a name="l02413"></a>02413         }
<a name="l02414"></a>02414 
<a name="l02415"></a>02415         JMenuItem aveCompAmpDisplayMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Display Time Average Plot..."</span>);
<a name="l02416"></a>02416         viewMenu.add(aveCompAmpDisplayMenuItem);
<a name="l02417"></a>02417         aveCompAmpDisplayMenuItem.addActionListener(<span class="keyword">new</span> AveCompAmpDisplayListener());
<a name="l02418"></a>02418 
<a name="l02419"></a>02419 
<a name="l02420"></a>02420         JMenu helpMenu = <span class="keyword">new</span> JMenu(<span class="stringliteral">"Help"</span>);
<a name="l02421"></a>02421         menuBar.add(helpMenu);
<a name="l02422"></a>02422 
<a name="l02426"></a>02426         <span class="keyword">class </span>HelpVersionListener <span class="keyword">implements</span> ActionListener
<a name="l02427"></a>02427         {
<a name="l02433"></a>02433             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e)
<a name="l02434"></a>02434             {
<a name="l02435"></a>02435                 JOptionPane.showMessageDialog(
<a name="l02436"></a>02436                         mainGuiFrame,
<a name="l02437"></a>02437                         <span class="stringliteral">"Version: $Revision: 1.76 $ $Date: 2009/06/12 00:14:06 $"</span>,
<a name="l02438"></a>02438                         <span class="stringliteral">"Waterfall Display"</span>,  <span class="comment">// dialog title</span>
<a name="l02439"></a>02439                         JOptionPane.INFORMATION_MESSAGE ); 
<a name="l02440"></a>02440             }
<a name="l02441"></a>02441         }
<a name="l02442"></a>02442         JMenuItem showVersionMenuItem =  <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Show Version..."</span>);
<a name="l02443"></a>02443         showVersionMenuItem.addActionListener(<span class="keyword">new</span> HelpVersionListener());
<a name="l02444"></a>02444         helpMenu.add(showVersionMenuItem);
<a name="l02445"></a>02445 
<a name="l02446"></a>02446 
<a name="l02447"></a>02447         Container cp = mainGuiFrame.getContentPane();
<a name="l02448"></a>02448         cp.setLayout(<span class="keyword">new</span> BorderLayout());
<a name="l02449"></a>02449         cp.add(BorderLayout.NORTH, controlPanel);
<a name="l02450"></a>02450         cp.add(BorderLayout.CENTER, scrollPane);
<a name="l02451"></a>02451     }
<a name="l02452"></a>02452 
<a name="l02453"></a>02453 
<a name="l02457"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#5d25b04f553ee52db2b5097095a2d6c3">02457</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#5d25b04f553ee52db2b5097095a2d6c3">init</a>()
<a name="l02458"></a>02458     {
<a name="l02459"></a>02459 
<a name="l02460"></a>02460         <span class="keywordflow">if</span> (usingGui)
<a name="l02461"></a>02461         {
<a name="l02462"></a>02462             <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#4d44788a67eb6c1af5739283a71bb968">setUpGui</a>();
<a name="l02463"></a>02463         }
<a name="l02464"></a>02464 
<a name="l02465"></a>02465         <span class="comment">// start file reading thread</span>
<a name="l02466"></a>02466         fileScanner = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1FileScanner.html">FileScanner</a>(inFilename, width, height);
<a name="l02467"></a>02467 
<a name="l02468"></a>02468         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#beff78ad50fd5b467ed9529c4c6ad9ce">redrawImage</a>();
<a name="l02469"></a>02469 
<a name="l02470"></a>02470     }
<a name="l02471"></a>02471 
<a name="l02475"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html">02475</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class </span><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html">WaterfallCmdLineOptions</a> 
<a name="l02476"></a>02476     {
<a name="l02477"></a>02477 
<a name="l02478"></a>02478         String inFilename;
<a name="l02479"></a>02479         String outFilename;
<a name="l02480"></a>02480         <span class="keywordtype">int</span> resolutionHz;
<a name="l02481"></a>02481         <span class="keywordtype">int</span> xpos;
<a name="l02482"></a>02482         <span class="keywordtype">int</span> ypos;
<a name="l02483"></a>02483         <span class="keywordtype">int</span> subbandOffset;
<a name="l02484"></a>02484         <span class="keywordtype">boolean</span> slowPlay;
<a name="l02485"></a>02485         <span class="keywordtype">boolean</span> repeatPlay;
<a name="l02486"></a>02486         <span class="keywordtype">boolean</span> batch;
<a name="l02487"></a>02487         String title;
<a name="l02488"></a>02488 
<a name="l02492"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#4f180555bfe7de0ee97241b6db18934b">02492</a>         <span class="keyword">public</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#4f180555bfe7de0ee97241b6db18934b">WaterfallCmdLineOptions</a>()
<a name="l02493"></a>02493         {
<a name="l02494"></a>02494             inFilename = <span class="stringliteral">""</span>;
<a name="l02495"></a>02495             outFilename = <span class="stringliteral">"waterfall.jpeg"</span>;
<a name="l02496"></a>02496             resolutionHz = 1;
<a name="l02497"></a>02497             xpos = 0;
<a name="l02498"></a>02498             ypos = 0;
<a name="l02499"></a>02499             subbandOffset = 0;
<a name="l02500"></a>02500             slowPlay = <span class="keyword">false</span>;
<a name="l02501"></a>02501             repeatPlay = <span class="keyword">false</span>;
<a name="l02502"></a>02502             batch = <span class="keyword">false</span>;
<a name="l02503"></a>02503             title = <span class="stringliteral">""</span>;
<a name="l02504"></a>02504         }
<a name="l02505"></a>02505 
<a name="l02511"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#fef76a04ccee9f4f49ca068c84b12bbd">02511</a>         <span class="keyword">public</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#fef76a04ccee9f4f49ca068c84b12bbd">getInFilename</a>()
<a name="l02512"></a>02512         {
<a name="l02513"></a>02513             <span class="keywordflow">return</span> inFilename;
<a name="l02514"></a>02514         }
<a name="l02515"></a>02515 
<a name="l02521"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#6f0245fba2b3d24cb7d22d41f57744fb">02521</a>         <span class="keyword">public</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#6f0245fba2b3d24cb7d22d41f57744fb">getOutFilename</a>()
<a name="l02522"></a>02522         {
<a name="l02523"></a>02523             <span class="keywordflow">return</span> outFilename;
<a name="l02524"></a>02524         }
<a name="l02525"></a>02525 
<a name="l02531"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#b32a8e92ea39f9f2b385d66b99b7485c">02531</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#b32a8e92ea39f9f2b385d66b99b7485c">getResolutionHz</a>()
<a name="l02532"></a>02532         {
<a name="l02533"></a>02533             <span class="keywordflow">return</span> resolutionHz;
<a name="l02534"></a>02534         }
<a name="l02535"></a>02535 
<a name="l02541"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#e81761c897bf42b058846e41f86cdcd7">02541</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#e81761c897bf42b058846e41f86cdcd7">getXpos</a>()
<a name="l02542"></a>02542         {
<a name="l02543"></a>02543             <span class="keywordflow">return</span> xpos;
<a name="l02544"></a>02544         }
<a name="l02545"></a>02545 
<a name="l02551"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#563dd9dde39360417f389cd1bd008e40">02551</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#563dd9dde39360417f389cd1bd008e40">getYpos</a>()
<a name="l02552"></a>02552         {
<a name="l02553"></a>02553             <span class="keywordflow">return</span> ypos;
<a name="l02554"></a>02554         }
<a name="l02555"></a>02555 
<a name="l02561"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#aafbb4e8b0ebdcf07b46f94659bde0e0">02561</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#aafbb4e8b0ebdcf07b46f94659bde0e0">getSubbandOffset</a>()
<a name="l02562"></a>02562         {
<a name="l02563"></a>02563             <span class="keywordflow">return</span> subbandOffset;
<a name="l02564"></a>02564         }
<a name="l02565"></a>02565 
<a name="l02571"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#02dedd6868cc50b9e371bd5c39598c34">02571</a>         <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#02dedd6868cc50b9e371bd5c39598c34">getSlowPlay</a>()
<a name="l02572"></a>02572         {
<a name="l02573"></a>02573             <span class="keywordflow">return</span> slowPlay;
<a name="l02574"></a>02574         }
<a name="l02575"></a>02575 
<a name="l02581"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#a697ddec421abd05129f8c7ef16bea1b">02581</a>         <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#a697ddec421abd05129f8c7ef16bea1b">getRepeatPlay</a>()
<a name="l02582"></a>02582         {
<a name="l02583"></a>02583             <span class="keywordflow">return</span> repeatPlay;
<a name="l02584"></a>02584         }
<a name="l02585"></a>02585 
<a name="l02591"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#cc7085d035e0a7fb4e6e085ffe42dc89">02591</a>         <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#cc7085d035e0a7fb4e6e085ffe42dc89">getBatch</a>()
<a name="l02592"></a>02592         {
<a name="l02593"></a>02593             <span class="keywordflow">return</span> batch;
<a name="l02594"></a>02594         }
<a name="l02595"></a>02595 
<a name="l02601"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#db7e73f739adf91ef688493fb87bd18f">02601</a>         <span class="keyword">public</span> String <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#db7e73f739adf91ef688493fb87bd18f">getTitle</a>()
<a name="l02602"></a>02602         {
<a name="l02603"></a>02603             <span class="keywordflow">return</span> title;
<a name="l02604"></a>02604         }
<a name="l02605"></a>02605 
<a name="l02613"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#6c3acd9eb4cf48c7df3eb3cddda4c3b8">02613</a>         <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#6c3acd9eb4cf48c7df3eb3cddda4c3b8">parseCommandLineArgs</a>(String[] args)
<a name="l02614"></a>02614         {
<a name="l02615"></a>02615 
<a name="l02616"></a>02616             <span class="keywordtype">int</span> i = 0;
<a name="l02617"></a>02617             <span class="keywordflow">while</span> (i &lt; args.length)
<a name="l02618"></a>02618             {
<a name="l02619"></a>02619 
<a name="l02620"></a>02620                 <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-file"</span>))
<a name="l02621"></a>02621                 {
<a name="l02622"></a>02622                     i++;
<a name="l02623"></a>02623                     <span class="keywordflow">if</span> (i &lt; args.length)
<a name="l02624"></a>02624                     {
<a name="l02625"></a>02625                         inFilename = args[i++];
<a name="l02626"></a>02626                     }
<a name="l02627"></a>02627                     <span class="keywordflow">else</span>
<a name="l02628"></a>02628                     {
<a name="l02629"></a>02629                         System.out.println(<span class="stringliteral">"Missing input filename argument"</span>);
<a name="l02630"></a>02630                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02631"></a>02631                     }
<a name="l02632"></a>02632 
<a name="l02633"></a>02633                 }
<a name="l02634"></a>02634                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-outfile"</span>))
<a name="l02635"></a>02635                 {
<a name="l02636"></a>02636                     i++;
<a name="l02637"></a>02637                     <span class="keywordflow">if</span> (i &lt; args.length)
<a name="l02638"></a>02638                     {
<a name="l02639"></a>02639                         outFilename = args[i++];
<a name="l02640"></a>02640                     }
<a name="l02641"></a>02641                     <span class="keywordflow">else</span>
<a name="l02642"></a>02642                     {
<a name="l02643"></a>02643                         System.out.println(<span class="stringliteral">"Missing output filename argument"</span>);
<a name="l02644"></a>02644                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02645"></a>02645                     }
<a name="l02646"></a>02646 
<a name="l02647"></a>02647                 }
<a name="l02648"></a>02648                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-res"</span>))
<a name="l02649"></a>02649                 {
<a name="l02650"></a>02650 
<a name="l02651"></a>02651                     i++;
<a name="l02652"></a>02652                     <span class="keywordflow">if</span> (i &lt; args.length)
<a name="l02653"></a>02653                     {
<a name="l02654"></a>02654                         String resString = args[i++];
<a name="l02655"></a>02655                         <span class="keywordflow">if</span> (resString.equals(<span class="stringliteral">"1"</span>)) 
<a name="l02656"></a>02656                         {
<a name="l02657"></a>02657                             resolutionHz = 1;
<a name="l02658"></a>02658                         }
<a name="l02659"></a>02659                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resString.equals(<span class="stringliteral">"2"</span>)) 
<a name="l02660"></a>02660                         {
<a name="l02661"></a>02661                             resolutionHz = 2;
<a name="l02662"></a>02662                         } 
<a name="l02663"></a>02663                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resString.equals(<span class="stringliteral">"4"</span>)) 
<a name="l02664"></a>02664                         {
<a name="l02665"></a>02665                             resolutionHz = 4;
<a name="l02666"></a>02666                         } 
<a name="l02667"></a>02667                         <span class="keywordflow">else</span> 
<a name="l02668"></a>02668                         {
<a name="l02669"></a>02669                             System.out.println(<span class="stringliteral">"invalid resolution Hz: must be 1, 2 or 4"</span>);
<a name="l02670"></a>02670                             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02671"></a>02671                         }
<a name="l02672"></a>02672 
<a name="l02673"></a>02673                     }  
<a name="l02674"></a>02674                     <span class="keywordflow">else</span> 
<a name="l02675"></a>02675                     {
<a name="l02676"></a>02676                         System.out.println(<span class="stringliteral">"Missing resolution argument"</span>);
<a name="l02677"></a>02677                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02678"></a>02678                     }
<a name="l02679"></a>02679 
<a name="l02680"></a>02680                 } 
<a name="l02681"></a>02681                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-xpos"</span>)) 
<a name="l02682"></a>02682                 {
<a name="l02683"></a>02683 
<a name="l02684"></a>02684                     i++;
<a name="l02685"></a>02685                     <span class="keywordflow">if</span> (i &lt; args.length) 
<a name="l02686"></a>02686                     {
<a name="l02687"></a>02687 
<a name="l02688"></a>02688                         <span class="keywordflow">try</span> 
<a name="l02689"></a>02689                         {
<a name="l02690"></a>02690                             xpos = Integer.parseInt(args[i++]);
<a name="l02691"></a>02691                         } 
<a name="l02692"></a>02692                         <span class="keywordflow">catch</span> (Exception e) 
<a name="l02693"></a>02693                         {
<a name="l02694"></a>02694                             System.out.println(<span class="stringliteral">"invalid x position"</span>);
<a name="l02695"></a>02695                             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02696"></a>02696                         }
<a name="l02697"></a>02697 
<a name="l02698"></a>02698                     }
<a name="l02699"></a>02699                     <span class="keywordflow">else</span>
<a name="l02700"></a>02700                     {
<a name="l02701"></a>02701                         System.out.println(<span class="stringliteral">"Missing xpos argument"</span>);
<a name="l02702"></a>02702                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02703"></a>02703                     }
<a name="l02704"></a>02704 
<a name="l02705"></a>02705                 }
<a name="l02706"></a>02706                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-ypos"</span>))
<a name="l02707"></a>02707                 {
<a name="l02708"></a>02708 
<a name="l02709"></a>02709                     i++;
<a name="l02710"></a>02710                     <span class="keywordflow">if</span> (i &lt; args.length)
<a name="l02711"></a>02711                     {
<a name="l02712"></a>02712 
<a name="l02713"></a>02713                         <span class="keywordflow">try</span> 
<a name="l02714"></a>02714                         {
<a name="l02715"></a>02715                             ypos = Integer.parseInt(args[i++]);
<a name="l02716"></a>02716                         } <span class="keywordflow">catch</span> (Exception e)
<a name="l02717"></a>02717                         {
<a name="l02718"></a>02718                             System.out.println(<span class="stringliteral">"invalid y position"</span>);
<a name="l02719"></a>02719                             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02720"></a>02720                         }
<a name="l02721"></a>02721 
<a name="l02722"></a>02722                     }
<a name="l02723"></a>02723                     <span class="keywordflow">else</span>
<a name="l02724"></a>02724                     {
<a name="l02725"></a>02725                         System.out.println(<span class="stringliteral">"Missing ypos argument"</span>);
<a name="l02726"></a>02726                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02727"></a>02727                     }
<a name="l02728"></a>02728 
<a name="l02729"></a>02729                 }
<a name="l02730"></a>02730                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-suboff"</span>))
<a name="l02731"></a>02731                 {
<a name="l02732"></a>02732 
<a name="l02733"></a>02733                     i++;
<a name="l02734"></a>02734                     <span class="keywordflow">if</span> (i &lt; args.length)
<a name="l02735"></a>02735                     {
<a name="l02736"></a>02736 
<a name="l02737"></a>02737                         <span class="keywordflow">try</span> 
<a name="l02738"></a>02738                         {
<a name="l02739"></a>02739                             subbandOffset = Integer.parseInt(args[i++]);
<a name="l02740"></a>02740                         } 
<a name="l02741"></a>02741                         <span class="keywordflow">catch</span> (Exception e)
<a name="l02742"></a>02742                         {
<a name="l02743"></a>02743                             System.out.println(<span class="stringliteral">"invalid subband offset"</span>);
<a name="l02744"></a>02744                             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02745"></a>02745                         }
<a name="l02746"></a>02746 
<a name="l02747"></a>02747                         <span class="keywordtype">int</span> MaxSubbandOffset = 15;
<a name="l02748"></a>02748                         <span class="keywordflow">if</span> (subbandOffset &lt; 0 || subbandOffset &gt; MaxSubbandOffset)
<a name="l02749"></a>02749                         {
<a name="l02750"></a>02750                             System.out.println(<span class="stringliteral">"subband offset out of range"</span>);                  
<a name="l02751"></a>02751                             System.out.println(<span class="stringliteral">"must be &gt;= 0 and &lt;= "</span> + MaxSubbandOffset);
<a name="l02752"></a>02752                             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02753"></a>02753                         }
<a name="l02754"></a>02754 
<a name="l02755"></a>02755                     }
<a name="l02756"></a>02756                     <span class="keywordflow">else</span>
<a name="l02757"></a>02757                     {
<a name="l02758"></a>02758                         System.out.println(<span class="stringliteral">"Missing subband offset argument"</span>);
<a name="l02759"></a>02759                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02760"></a>02760                     }
<a name="l02761"></a>02761                 } 
<a name="l02762"></a>02762                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-slow"</span>))
<a name="l02763"></a>02763                 {
<a name="l02764"></a>02764                     i++;
<a name="l02765"></a>02765                     slowPlay = <span class="keyword">true</span>;
<a name="l02766"></a>02766                 } 
<a name="l02767"></a>02767                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-repeat"</span>))
<a name="l02768"></a>02768                 {
<a name="l02769"></a>02769                     i++;
<a name="l02770"></a>02770                     repeatPlay = <span class="keyword">true</span>;
<a name="l02771"></a>02771 
<a name="l02772"></a>02772                 } 
<a name="l02773"></a>02773                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-batch"</span>))
<a name="l02774"></a>02774                 {
<a name="l02775"></a>02775                     i++;
<a name="l02776"></a>02776                     batch = <span class="keyword">true</span>;
<a name="l02777"></a>02777                 }
<a name="l02778"></a>02778                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args[i].equals(<span class="stringliteral">"-title"</span>))
<a name="l02779"></a>02779                 {
<a name="l02780"></a>02780                     i++;
<a name="l02781"></a>02781                     <span class="keywordflow">if</span> (i &lt; args.length)
<a name="l02782"></a>02782                     {
<a name="l02783"></a>02783                         <span class="comment">// grab first word of title</span>
<a name="l02784"></a>02784                         title += args[i++];
<a name="l02785"></a>02785                     }
<a name="l02786"></a>02786                     <span class="keywordflow">else</span>
<a name="l02787"></a>02787                     {
<a name="l02788"></a>02788                         System.out.println(<span class="stringliteral">"Missing title argument"</span>);
<a name="l02789"></a>02789                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02790"></a>02790                     }
<a name="l02791"></a>02791 
<a name="l02792"></a>02792                     <span class="comment">// Grab rest of title words</span>
<a name="l02793"></a>02793                     <span class="comment">// until arguments run out or </span>
<a name="l02794"></a>02794                     <span class="comment">// another keyword shows up</span>
<a name="l02795"></a>02795                     <span class="comment">// (prefixed with hypen)</span>
<a name="l02796"></a>02796 
<a name="l02797"></a>02797                     <span class="keywordflow">while</span> (i &lt; args.length)
<a name="l02798"></a>02798                     {
<a name="l02799"></a>02799                         <span class="keywordflow">if</span> (args[i].charAt(0) == <span class="charliteral">'-'</span>)
<a name="l02800"></a>02800                         {
<a name="l02801"></a>02801                             <span class="keywordflow">break</span>;
<a name="l02802"></a>02802                         }
<a name="l02803"></a>02803                         title += <span class="stringliteral">" "</span>;
<a name="l02804"></a>02804                         title += args[i++];
<a name="l02805"></a>02805                     }
<a name="l02806"></a>02806 
<a name="l02807"></a>02807                 }
<a name="l02808"></a>02808                 <span class="keywordflow">else</span>
<a name="l02809"></a>02809                 {
<a name="l02810"></a>02810                     System.out.println(<span class="stringliteral">"invalid option: "</span> + args[i]);
<a name="l02811"></a>02811                     System.out.println(<span class="stringliteral">"valid options: [-file &lt;inFilename&gt;] [-res &lt;1 | 2&gt;] [-xpos &lt;x position&gt;] [-ypos &lt;y position&gt;] [-slow] [-repeat] [-suboff &lt;subband offset&gt;] [-batch] [-outfile &lt;outFilename&gt;] [-title &lt;text&gt;]"</span>);
<a name="l02812"></a>02812                     System.out.println(<span class="stringliteral">"-file: input filename"</span>);
<a name="l02813"></a>02813                     System.out.println(<span class="stringliteral">"-res: data display resolution in Hz (1 or 2)"</span>);
<a name="l02814"></a>02814                     System.out.println(<span class="stringliteral">"-xpos: window x position"</span>);
<a name="l02815"></a>02815                     System.out.println(<span class="stringliteral">"-ypos: window y position"</span>);
<a name="l02816"></a>02816                     System.out.println(<span class="stringliteral">"-slow: play slowly"</span>);
<a name="l02817"></a>02817                     System.out.println(<span class="stringliteral">"-repeat: repeatedly read data file"</span>);
<a name="l02818"></a>02818                     System.out.println(<span class="stringliteral">"-suboff: subband offset to display (0-15)"</span>);
<a name="l02819"></a>02819                     System.out.println(<span class="stringliteral">"-batch: no GUI, send waterfall image to jpeg file"</span>);
<a name="l02820"></a>02820                     System.out.println(<span class="stringliteral">"-outfile: output filename for batch mode (default: 'waterfall.jpeg')"</span>);
<a name="l02821"></a>02821                     System.out.println(<span class="stringliteral">"-title: text for title (batch mode only, default: input filename)"</span>);
<a name="l02822"></a>02822                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02823"></a>02823                 } 
<a name="l02824"></a>02824             }
<a name="l02825"></a>02825 
<a name="l02826"></a>02826             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02827"></a>02827         }
<a name="l02828"></a>02828 
<a name="l02829"></a>02829     }
<a name="l02830"></a>02830 
<a name="l02836"></a><a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#dadaedbd1dc87b7f2083c90b4d91204f">02836</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#dadaedbd1dc87b7f2083c90b4d91204f">main</a>(String[] args)
<a name="l02837"></a>02837     {
<a name="l02838"></a>02838 
<a name="l02839"></a>02839         <span class="comment">// Note: -batch mode must be run with "java -Djava.awt.headless=true"</span>
<a name="l02840"></a>02840 
<a name="l02841"></a>02841         <span class="keywordtype">int</span> imageWidth=768;
<a name="l02842"></a>02842         <span class="keywordtype">int</span> imageHeight=800;
<a name="l02843"></a>02843         <span class="keywordtype">int</span> extraWidth=40;   <span class="comment">// add enough to show full image </span>
<a name="l02844"></a>02844         <span class="keywordtype">int</span> frameWidth=imageWidth+extraWidth; 
<a name="l02845"></a>02845         <span class="keywordtype">int</span> frameHeight=500;
<a name="l02846"></a>02846 
<a name="l02847"></a>02847         <span class="keywordtype">float</span> pixelScaleFactor=4;
<a name="l02848"></a>02848         <span class="keywordtype">float</span> pixelOffsetFactor=0;
<a name="l02849"></a>02849 
<a name="l02850"></a>02850         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html">WaterfallCmdLineOptions</a> options = <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html">WaterfallCmdLineOptions</a>();
<a name="l02851"></a>02851         <span class="keywordflow">if</span> ( ! options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#6c3acd9eb4cf48c7df3eb3cddda4c3b8">parseCommandLineArgs</a>(args) )
<a name="l02852"></a>02852         {
<a name="l02853"></a>02853             System.exit(1);
<a name="l02854"></a>02854         }
<a name="l02855"></a>02855 
<a name="l02856"></a>02856         <span class="keywordtype">boolean</span> usingGui = ! options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#cc7085d035e0a7fb4e6e085ffe42dc89">getBatch</a>();
<a name="l02857"></a>02857 
<a name="l02858"></a>02858         <span class="keywordflow">if</span> (options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#b32a8e92ea39f9f2b385d66b99b7485c">getResolutionHz</a>() == 2)
<a name="l02859"></a>02859         {
<a name="l02860"></a>02860             <span class="keywordflow">if</span> (usingGui)
<a name="l02861"></a>02861             {
<a name="l02862"></a>02862                 <span class="comment">// Narrow the frame width for 2 hz resolution.</span>
<a name="l02863"></a>02863                 <span class="comment">// Don't change the image width in case the</span>
<a name="l02864"></a>02864                 <span class="comment">// frame gets expanded back to 1 Hz mode later.</span>
<a name="l02865"></a>02865 
<a name="l02866"></a>02866                 frameWidth=imageWidth / 2 + extraWidth;
<a name="l02867"></a>02867             }
<a name="l02868"></a>02868             <span class="keywordflow">else</span>
<a name="l02869"></a>02869             {
<a name="l02870"></a>02870                 <span class="comment">// Adjust image size so that created jpeg image is</span>
<a name="l02871"></a>02871                 <span class="comment">// only as wide as it needs to be.</span>
<a name="l02872"></a>02872 
<a name="l02873"></a>02873                 imageWidth = 539;
<a name="l02874"></a>02874             }
<a name="l02875"></a>02875         }
<a name="l02876"></a>02876 
<a name="l02877"></a>02877         <span class="comment">//System.out.println("filename is " + options.getFilename());</span>
<a name="l02878"></a>02878         <span class="comment">//System.out.println("res is " + options.getResolutionHz());</span>
<a name="l02879"></a>02879 
<a name="l02880"></a>02880         JFrame frame = null;
<a name="l02881"></a>02881         <span class="keywordflow">if</span> (usingGui)
<a name="l02882"></a>02882         {
<a name="l02883"></a>02883             frame = <span class="keyword">new</span> JFrame(<span class="stringliteral">"Waterfall Display - SonATA Complex Amplitudes"</span>);
<a name="l02884"></a>02884             frame.setLocation(<span class="keyword">new</span> Point(options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#e81761c897bf42b058846e41f86cdcd7">getXpos</a>(), options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#563dd9dde39360417f389cd1bd008e40">getYpos</a>()));
<a name="l02885"></a>02885         }
<a name="l02886"></a>02886         <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html">WaterfallDisplay</a> waterfall =
<a name="l02887"></a>02887             <span class="keyword">new</span> <a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#8db7f74cbaed8dd6e14f0a5c1374c3a4">WaterfallDisplay</a>(usingGui,
<a name="l02888"></a>02888                     frame, 
<a name="l02889"></a>02889                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#fef76a04ccee9f4f49ca068c84b12bbd">getInFilename</a>(),
<a name="l02890"></a>02890                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#6f0245fba2b3d24cb7d22d41f57744fb">getOutFilename</a>(),
<a name="l02891"></a>02891                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#aafbb4e8b0ebdcf07b46f94659bde0e0">getSubbandOffset</a>(),
<a name="l02892"></a>02892                     imageWidth, imageHeight, 
<a name="l02893"></a>02893                     pixelScaleFactor, pixelOffsetFactor,
<a name="l02894"></a>02894                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#b32a8e92ea39f9f2b385d66b99b7485c">getResolutionHz</a>(),
<a name="l02895"></a>02895                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#02dedd6868cc50b9e371bd5c39598c34">getSlowPlay</a>(), 
<a name="l02896"></a>02896                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#a697ddec421abd05129f8c7ef16bea1b">getRepeatPlay</a>(),
<a name="l02897"></a>02897                     options.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay_1_1WaterfallCmdLineOptions.html#db7e73f739adf91ef688493fb87bd18f">getTitle</a>());
<a name="l02898"></a>02898 
<a name="l02899"></a>02899         <span class="keywordflow">if</span> (usingGui)
<a name="l02900"></a>02900         {
<a name="l02901"></a>02901             frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
<a name="l02902"></a>02902             frame.getContentPane().add(waterfall);
<a name="l02903"></a>02903             frame.setSize(frameWidth, frameHeight);
<a name="l02904"></a>02904         }
<a name="l02905"></a>02905 
<a name="l02906"></a>02906         waterfall.<a class="code" href="classopensonata_1_1dataDisplays_1_1WaterfallDisplay.html#5d25b04f553ee52db2b5097095a2d6c3">init</a>();
<a name="l02907"></a>02907 
<a name="l02908"></a>02908         <span class="keywordflow">if</span> (usingGui) 
<a name="l02909"></a>02909         {
<a name="l02910"></a>02910             frame.setVisible(<span class="keyword">true</span>);
<a name="l02911"></a>02911         }
<a name="l02912"></a>02912 
<a name="l02913"></a>02913     }
<a name="l02914"></a>02914 }
<a name="l02915"></a>02915 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
